<!doctype html><html lang="en"><head><title>About</title><meta charset="utf-8"><meta name="description" content="11ty site documenting 11ty"><meta name="theme-color" content="cornflowerblue"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" href="/blog/assets/mark-volkmann-192.png"><link rel="icon" type="image/png" sizes="96x96" href="/blog/assets/favicon-blue.png"><link rel="manifest" href="/blog/assets/manifest.json"><link rel="preload" as="style" href="/blog/assets/styles.css"><link rel="stylesheet" href="/blog/assets/styles.css"><link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/github-actions.css"><script>// Only register the service worker when not on localhost.
      if (location.hostname !== 'localhost' && 'serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/blog/service-worker.js');
        })
      }

      let nav;
      let navOpen = false;

      function toggleMenu() {
        navOpen = !navOpen;
        nav.style.left = navOpen ?
          0 :
          '-' + nav.getBoundingClientRect().width + 'px';
        nav
      }

      window.onload = () => {
        nav = document.querySelector('nav');
        const scrollTop = sessionStorage.getItem('navScroll');
        if (scrollTop) nav.scrollTop = scrollTop;

        nav.onscroll = () => {
          sessionStorage.setItem('navScroll', nav.scrollTop);
        };
      }</script></head><body><header><h1><button class="hamburger" onclick="toggleMenu()">&#x2630;</button> Mark Volkmann's Blog</h1><a class="crumb" href="/blog/github-actions/">GitHub Actions</a> ...</header><main><nav onscroll="navScrolled()"><ul><li class="ordered" class="top"><a href="/blog/">Welcome</a></li><li class="top"><a href="/blog/eleventy/">Eleventy ></a></li><li class="top"><a href="/blog/github-actions/">GitHub Actions ></a><ul><li class="active"><a href="/blog/github-actions/about/">About</a></li></ul></li><li class="top"><a href="/blog/markdown/">Markdown</a></li><li class="top"><a href="/blog/yaml/">YAML</a></li></ul></nav><section><h2>About</h2><p>GitHub Actions enable registering &quot;jobs&quot; to run on a cloud server in response to GitHub commands completing. The cloud server must have the GitHub Actions runner application is installed. GitHub provides these servers for free, but it is also possible to use your on servers.</p><p>For example, an workflow can build an application after every push. This can include running linters, code formatters, and tests. Executed workflows and their output appear in the &quot;Actions&quot; tab of the GitHub repository.</p><p>A &quot;workflow&quot; defines a set of jobs using a YAML file. A job defines a set up steps to run in a given environment (ex. `ubuntu-latest'); A step is a single task runs a predefined action or a shell command.</p><h2>Configuring Workflows</h2><p>Workflows for a repository are configured by YAML files in the <code>.github/workflows</code> directory. Here is a simple example defined in a file named <code>demo.yml</code>. It uses an action defined at <a href="https://github.com/actions/hello-world-javascript-action">https://github.com/actions/hello-world-javascript-action</a>.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> My Demo<br><span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build</span><span class="token punctuation">:</span> <span class="token comment"># a job id</span><br>    <span class="token key atrule">name</span><span class="token punctuation">:</span> DemoJob <span class="token comment"># a job name</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hello<br>        <span class="token key atrule">id</span><span class="token punctuation">:</span> hello<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/hello<span class="token punctuation">-</span>world<span class="token punctuation">-</span>javascript<span class="token punctuation">-</span>action@master<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">who-to-greet</span><span class="token punctuation">:</span> <span class="token string">'Mark Volkmann'</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Time<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo 'The time was $.'</code></pre><p>This executes on every push to the repository.</p><p>For workflows that will run on a GitHub-hosted server (a.k.a. runner), the operating system of the server can be specified. This can be the latest version of a particular OS or a specific version. Current options include:</p><ul><li><code>ubuntu-latest</code></li><li><code>windows-latest</code></li><li><code>macos-latest</code>.</li><li><code>ubuntu-18.04</code></li><li><code>ubuntu-16.04</code></li><li><code>windows-2019</code></li><li><code>macos-10.15</code>.</li></ul><p>Workflows can also be self-hosted. An example of specifying this is:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">runs-on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>self<span class="token punctuation">-</span>hosted<span class="token punctuation">,</span> linux<span class="token punctuation">]</span></code></pre><p>In the example above, <code>build</code> is a job id. TODO: Where are job ids displayed in the web UI? This workflow only defines one job. Defining multiple jobs is useful to allow some steps to run on a server that uses a different operating system.</p><p>Each step (a.k.a. action) is defined by a number of properties.</p><table><thead><tr><th>Property Name</th><th>Meaning</th></tr></thead><tbody><tr><td><code>name</code></td><td>step name that appears in the web UI that shows workflow results</td></tr><tr><td><code>uses</code></td><td>a predefined action to use</td></tr><tr><td><code>with</code></td><td>arguments to pass to the action</td></tr><tr><td><code>id</code></td><td>name that will be used to refer to action result properties</td></tr></tbody></table><p>The property with the name specified by <code>id</code> is an object with an <code>outputs</code> property that is an object that holds all the output values. Actions typically document their outputs. In this case the only output is a <code>time</code> property which is the time at which the action executed.</p><h2>Viewing Action Results</h2><p>The &quot;Actions&quot; tab of a GitHub repository is shown below.</p><p><img src="/blog/assets/github-actions-web-ui-1.png" alt="GitHub Actions web UI #1"></p><p>The workflows that have been executed can be filtered on the event that triggered them (ex. &quot;push&quot;), their status (ex. &quot;success&quot; or &quot;failure&quot;), the targeted branch, and the GitHub user name that triggered it.</p><p>Clicking a workflow row displays details about its execution.</p><p><img src="/blog/assets/github-actions-web-ui-2.png" alt="GitHub Actions web UI #1"></p><p>Click a job name (ex. &quot;DemoJob&quot;) in the left nav to see details. This displays information about the steps &quot;Set up job&quot;, &quot;Complete Job&quot;, and each named step in the workflow, &quot;Hello&quot; and &quot;Time&quot; in this example. Click the disclosure triangle in front of a step name to see its detail.</p><p>Here we see the &quot;Set up job&quot; and &quot;Hello&quot; steps expanded.</p><p><img src="/blog/assets/github-actions-web-ui-3.png" alt="GitHub Actions web UI #1"></p><p>The &quot;Set up job&quot; step shows the operating system that was used and actions that were downloaded (ex. &quot;hello-world-javascript-action&quot;).</p><p>Here we see the &quot;Time&quot; and &quot;Complete Job&quot; steps expanded. In this example the &quot;Time&quot; step shows the time at which the &quot;Hello&quot; step was executed.</p><p><img src="/blog/assets/github-actions-web-ui-4.png" alt="GitHub Actions web UI #2"></p><h2>Workflow Templates</h2><p>A workflow can be created from the GitHub web UI. Click the &quot;Actions&quot; tab and press the &quot;New workflow&quot; button. This presents a series of boxes that describe workflow templates. Click the &quot;Set up this workflow&quot; button inside one of the boxes to create a workflow based on that template.</p><p>Here is an example workflow file that does this. For example, the &quot;Node.js&quot; template contains the following:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Node.js CI<br><br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br>  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br><br>    <span class="token key atrule">strategy</span><span class="token punctuation">:</span><br>      <span class="token key atrule">matrix</span><span class="token punctuation">:</span><br>        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>10.x<span class="token punctuation">,</span> 12.x<span class="token punctuation">]</span><br><br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use Node.js $NaN<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> $NaN<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build <span class="token punctuation">-</span><span class="token punctuation">-</span>if<span class="token punctuation">-</span>present<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm test<br>        <span class="token key atrule">env</span><span class="token punctuation">:</span><br>          <span class="token key atrule">CI</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre><p>It offers to save this a <code>.github/workflows/nodejs.yml</code> in your repository. You can customize the file name and the workflow definition if desired. When ready to save it, press the &quot;Start Commit&quot; button in the upper-right. A dialog will appear. Optionally enter a commit comment and press the &quot;Commit new file&quot; button. Do a &quot;git pull&quot; to get the new workflow file in your local repository. The new workflow will be scheduled to run immediately. Click the &quot;Actions&quot; tab to see the results.</p><p>Two events trigger this workflow to execute. The first is a push to the master branch. The second is a pull request to the master branch.</p><p>Setting <code>strategy.matrix.node-version</code> to an array of version numbers causes it to execute the steps in each version of Node. This is useful to run tests in multiple versions of Node. To only use the latest version of version 12, remove <code>strategy.matrix.node-version</code> and change the <code>node-version</code> property for the <code>setup-node</code> step to just <code>12.x</code>.</p><p>This workflow runs the following commands:</p><ul><li><code>actions/checkout@v2</code> is a predefined action that checks out the most recent commit to a given branch which defaults to &quot;master&quot;. See <a href="https://github.com/actions/checkout">https://github.com/actions/checkout</a> for options.</li><li><code>actions/setup-node@v1</code> is a predefined action that sets the Node environment to be used by actions. It uses a version specified in <code>strategy.matrix.node-version</code> unless the <code>node-version</code> property is specified. When the matrix property specifies Node versions, the version used in a particular run becomes part of the step name. See <a href="https://github.com/actions/setup-node">https://github.com/actions/setup-node</a> for options.</li><li><code>npm ci</code> does a clean install of all dependencies. It is similar to <code>npm install</code>, but differs in that<ul><li>if the <code>node_modules</code> directory exists, it is deleted</li><li><code>package-lock.json</code> must exist</li><li>it is an error if <code>package.json</code> specifies different dependencies or versions than <code>package-lock.json</code></li><li><code>package-lock.json</code> will not be updated</li></ul></li><li><code>npm run build --if-present</code> runs the <code>build</code> script if it is defined, but it is not treated as an error if it is missing.</li><li><code>npm test</code> runs tests using the commands in the <code>test</code> script. This sets the <code>CI</code> environment variable to <code>true</code> which means that warnings from tests will be treated as errors and cause the build to fail.</li></ul><p>TODO: Is there an issue with having more than one workflow file? TODO: It seems only one gets executed.</p><h2>Executing Shell Commands</h2><p>GitHub Actions do not have to use an existing action such &quot;hello-world-javascript-action&quot;. They can also execute shell commands.</p><h2>Using Secrets</h2><p>To use secret information like passwords and tokens in a workflow, create GitHub secrets. To add a secret to a GitHub repo:</p><ul><li>browse the GitHub repo</li><li>click the &quot;Settings&quot; tab</li><li>click &quot;Secrets&quot; in the left nav</li><li>click &quot;Add a new secret&quot;</li><li>for the name, enter &quot;GH_TOKEN&quot;</li><li>for the value, paste in your GitHub personal access token</li><li>click &quot;Add secret&quot;</li></ul><p>Secrets can then be referenced by name in a workflow with the syntax <code>$</code> where <code>name</code> is the secret name. This is used in the following workflow.</p><h2>Building and Publishing an Eleventy Site</h2><p>Here is a workflow file that builds and deploys an Eleventy site on every push.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Eleventy build and deploy<br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> git checkout<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Node.js setup<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> 12.x<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> npm clean install<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> site build<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> site deploy<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> peaceiris/actions<span class="token punctuation">-</span>gh<span class="token punctuation">-</span>pages@v3<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $<br>          <span class="token key atrule">publish_dir</span><span class="token punctuation">:</span> ./_site</code></pre><p>For more details, see <a href="https://github.com/peaceiris/actions-gh-pages">https://github.com/peaceiris/actions-gh-pages</a>.</p><h2>Defining Actions</h2></section></main><footer>&copy; R. Mark Volkmann, 2020</footer></body></html>