<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Nunjucks</h2><p><a href="https://mozilla.github.io/nunjucks/">Nunjucks</a><br>is a template language implemented in JavaScript.<br>It supports features seen in most programming languages.</p><h2>VS Code extensions</h2><p>The VS Code extension &quot;Nunjucks&quot; (ronnidc.nunjucks)<br>applies syntax highlighting in <code>.njk</code> files.</p><p>The VS Code extension &quot;Nunjucks Snippets&quot;<br>(luwenjiechn.nunjucks-vscode-snippets) defines Nunjucks snippets<br>to simplifying writing Nunjucks constructs in <code>.njk</code> files.</p><h2>Configuration</h2><p>TODO: Cover other nunjucks-specific configuration.</p><h2>Data types</h2><p>Nunjucks essentially supports the same data types as JavaScript.<br>These include:</p><ul><li>Boolean: true, false</li><li>Numbers: 2, 3.4</li><li>Strings: &quot;in double-quotes&quot;, 'in single-quotes'</li><li>Arrays: [true, 2, 'test']</li><li>Dicts: { key1: true, key2: 'text' }</li></ul><h2>Operators</h2><p>Nunjucks supports these mathematical operators:</p><ul><li>+, -, *, /</li><li>// (integer division)</li><li>% (modulo)</li><li>** (exponentiation)</li></ul><p>Nunjucks supports these comparison operators from JavaScript:</p><ul><li>==, ===</li><li>!=, !==</li><li>&lt;, &lt;=, &gt;=, &gt;</li></ul><p>Nunjucks supports these logical operators:</p><ul><li>and, or, not</li><li>parentheses to group expressions</li></ul><h2>Comments</h2><p>The syntax for comments is:</p><pre class="language-liquid"><code class="language-liquid">{# some <span class="token keyword">comment</span> #}</code></pre><h2>Variables</h2><p>To define or modify a variable:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> set name <span class="token operator">=</span> value <span class="token operator">%</span>}</code></pre><p>Variables defined at the top-level are global.<br>Otherwise they are scoped to the construct in which they are defined.</p><h2>Rendering</h2><p>To render an expression, enclose it in double-curly braces.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{{ dog.name }}</code></pre><h2>Filters</h2><p>Nunjucks can render the result of passing a value through a filter.<br>There are many provided filters and custom filters can be implemented.<br>The provided filters are documented at<br><a href="https://mozilla.github.io/nunjucks/templating.html#builtin-filters">Builtin Filters</a>.<br>They include <code>abs</code>, <code>batch</code>, <code>capitalize</code>, <code>center</code>, <code>default</code>,<br><code>dictsort</code>, <code>dump</code>, <code>escape</code>, <code>first</code>, <code>float</code>, <code>forceescape</code>,<br><code>groupby</code>, <code>indent</code>, <code>int</code>, <code>join</code>, <code>last</code>, <code>length</code>, <code>list</code>,<br><code>lower</code>, <code>nl2br</code>, <code>random</code>, <code>rejectattr</code>, <code>replace</code>, <code>reverse</code>,<br><code>round</code>, <code>safe</code>, <code>selectattr</code>, <code>slice</code>, <code>sort</code>, <code>string</code>, <code>striptags</code>,<br><code>sum</code>, <code>title</code>, <code>trim</code>, <code>truncate</code>, <code>upper</code>, <code>urlencode</code>, <code>urlize</code>,<br>and <code>wordcount</code>.</p><p>There are too many to describe, but here are some highlights:</p><ul><li><p><code>dump</code> calls <code>JSON.stringify</code> on a value and is useful for debugging.</p></li><li><p><code>first</code> returns the first element of an array or the first character of a string.</p></li><li><p><code>last</code> returns the last element of an array or the last character of a string.</p></li><li><p><code>groupby</code> creates an array of arrays of objects from an array of objects<br>based on a common property value.</p></li><li><p><code>join</code> concatenates an array of values, separated by a delimiter</p></li><li><p><code>nl2br</code> replaces newline characters with HTML <code>&lt;br /&gt;</code> elements</p></li><li><p><code>random</code> returns a random element from an array</p></li><li><p><code>rejectattr</code> filters an array of objects, rejecting those where a given property passes a test</p></li><li><p><code>selectattr</code> filters an array of objects, keeping those where a given property passes a test</p></li><li><p><code>sort</code> sorts an array. It is called as a function with three arguments.<br>The first is a boolean indicating whether the sort should be in reverse order.<br>The second is a boolean indicating whether the sort should be case insensitive.<br>The third is the string name of the property on which the objects should be sorted.<br>For example, <code>{% for team in hockey | sort(false, false, 'city') %}</code> .</p></li><li><p><code>urlencode</code> encodes a URL using UTF-8.</p></li><li><p><code>urlize</code> turns URLs in a string into links.<br>The string can contain any number of URLs.<br>The result must be passed to the <code>safe</code> filter.<br>Otherwise the resulting HTML is escaped and presented as plain text.<br>For example,</p><pre class="language-liquid"><code class="language-liquid">{{ 'before http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>foo.bar after' <span class="token operator">|</span> urlize <span class="token operator">|</span> safe }}</code></pre><p>renders <code>before &lt;a href=&quot;http://foo.bar&quot;&gt;http://foo.bar&lt;/a&gt; after</code>.</p></li></ul><p>Here is an example of applying the <code>upper</code> filter to a string:</p><pre class="language-liquid"><code class="language-liquid">{{ dog.name <span class="token operator">|</span> upper }}</code></pre><p>Another syntax is available for applying a filter<br>to a large amount of content.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> filter upper <span class="token operator">%</span>}<br>  Mark is a software engineer at Object Computing, Inc.<br>{<span class="token operator">%</span> endfilter <span class="token operator">%</span>}</code></pre><p>This form can only contain literal content, not other Nunjucks constructs.</p><p>Nunjucks also supports defining custom filters.<br>When using 11ty, they can be defined in the <code>.eleventy.js</code>.<br>For example, this filter writes the value of an expression<br>to the devtools console.</p><pre class="language-js"><code class="language-js">eleventyConfig<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This filter will be added to 11ty in version 11.</p><h2>Conditional logic</h2><p>Content can be conditionally included using an <code>if</code> statement.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> <span class="token keyword">if</span> color <span class="token operator">==</span><span class="token operator">=</span> 'yellow' <span class="token operator">%</span>}<br>  sunny<br>{<span class="token operator">%</span> elif color <span class="token operator">==</span><span class="token operator">=</span> 'blue' <span class="token operator">%</span>}<br>  rainy<br>{<span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span>}<br>  unknown<br>{<span class="token operator">%</span> <span class="token keyword">endif</span> <span class="token operator">%</span>}</code></pre><p>Nunjucks supports using and <code>if</code> for an odd kind of ternary operator.<br>For example, this outputs &quot;yellow&quot; if <code>happy</code> is true.</p><pre class="language-liquid"><code class="language-liquid">{{ "yellow" <span class="token keyword">if</span> happy }}</code></pre><p>This is similar, but outputs &quot;gray&quot; if <code>happy</code> is false.</p><pre class="language-liquid"><code class="language-liquid">{{ "yellow" <span class="token keyword">if</span> happy <span class="token keyword">else</span> "gray" }}</code></pre><h2>Iteration</h2><p>A <code>for</code> loop iterates over the elements of an array<br>or the properties of an object<br>and renders content for each element.<br>An optional <code>else</code> block specifies content to render if the array is empty.</p><p>If the variable <code>dogs</code> holds an array of objects,<br>we can iterate over the array as follows:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> <span class="token keyword">for</span> dog <span class="token keyword">in</span> dogs <span class="token operator">%</span>}<br>  <span class="token operator">&lt;</span>p<span class="token operator">></span>{{ dog.name }} is a {{ dog.breed }}.&lt;<span class="token operator">/</span>p<span class="token operator">></span><br>{<span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span>}<br>  <span class="token operator">&lt;</span>p<span class="token operator">></span>Who let the dogs out<span class="token operator">?</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>{<span class="token operator">%</span> <span class="token keyword">endfor</span> <span class="token operator">%</span>}</code></pre><p>The current loop index is available in<br><code>loop.index</code> (starts from 1) and <code>loop.index0</code> (starts from 0).</p><p>If the variable <code>dog</code> holds an object,<br>we can iterate over its properties as follows:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> <span class="token keyword">for</span> key, value <span class="token keyword">in</span> dog <span class="token operator">%</span>}<br>  <span class="token operator">&lt;</span>p<span class="token operator">></span>{{key}} <span class="token operator">=</span> {{value}}<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>{<span class="token operator">%</span> <span class="token keyword">endfor</span> <span class="token operator">%</span>}</code></pre><p>There is also support for asynchronous versions of this<br>(<code>asyncEach</code> and <code>asyncAll</code>) that most sites will not need.<br>It is documented at<br><a href="https://mozilla.github.io/nunjucks/api.html#asynchronous-support">Asynchronous Support</a>.</p><h2>Function calls</h2><p>JavaScript functions can be called using the same syntax as JavaScript.<br>For example, this calls a function and renders its result:</p><pre class="language-liquid"><code class="language-liquid">{{ someFunction(arg1, arg2) }}</code></pre><p>This calls a function and assigns its result to a variable:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> set name <span class="token operator">=</span> someFunction(arg1, arg2) }}</code></pre><h2>Regular expressions</h2><p>Regular expressions are defined by beginning with <code>r/</code>.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> set re <span class="token operator">=</span> r<span class="token operator">/</span><span class="token operator">^</span>a.*z$<span class="token operator">/</span>i <span class="token operator">%</span>}<br>{<span class="token operator">%</span> <span class="token keyword">if</span> re.test(dog.name) <span class="token operator">%</span>}<br>  This dog goes from a to z<span class="token operator">!</span><br>{<span class="token operator">%</span> <span class="token keyword">endif</span> <span class="token operator">%</span>}</code></pre><p>The <code>i</code> option at the end of the regular expression<br>signifies case-insensitive matching.</p><h2>Sanitizing</h2><p>When rendering HTML from a potentially untrusted source,<br>use the <code>safe</code> filter to sanitize it.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{{ someHtml <span class="token operator">|</span> safe }}</code></pre><h2>Includes</h2><p>One template can include another.<br>This allows a template to be reused in many places.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> <span class="token function">include</span> "snippet.html" <span class="token operator">%</span>}</code></pre><p>This is useful when the content to be included<br>doesn't require any data to be supplied.<br>When data is required, consider using Nunjucks macros<br>which are described next.</p><h2>Macros</h2><p>Macros are like functions that have parameters<br>and render something based on those.<br>Parameters can have default values that are used when a value is not provided.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> macro dogP(name, breed, gender<span class="token operator">=</span>'unknown') <span class="token operator">%</span>}<br>  <span class="token operator">&lt;</span>p<span class="token operator">></span>{{name}} is a {{gender}} {{breed}}.&lt;<span class="token operator">/</span>p<span class="token operator">></span><br>{<span class="token operator">%</span> endmacro <span class="token operator">%</span>}</code></pre><p>A macro call looks like a function call.<br>For example:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> <span class="token keyword">for</span> dog <span class="token keyword">in</span> collections.dogsByName <span class="token operator">%</span>}<br>  {{ dogP(dog.data.name, dog.data.breed, dog.data.gender) }}<br>{<span class="token operator">%</span> <span class="token keyword">endfor</span> <span class="token operator">%</span>}</code></pre><p>Arguments can be specified positionally or by name.<br>The previous example used positional arguments.<br>The next example uses named arguments.</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> <span class="token keyword">for</span> dog <span class="token keyword">in</span> collections.dogsByName <span class="token operator">%</span>}<br>  {{ dogP(gender<span class="token operator">=</span>dog.data.gender, breed<span class="token operator">=</span>dog.data.breed, name<span class="token operator">=</span>dog.data.name) }}<br>{<span class="token operator">%</span> <span class="token keyword">endfor</span> <span class="token operator">%</span>}</code></pre><p>Macros can be defined in a <code>.njk</code> file and imported where needed.<br>For example, the following imports the file <code>_includes/macros.njk</code>:</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> import 'macros.njk' as macros with context <span class="token operator">%</span>}</code></pre><p>To call a macro named &quot;demo&quot; that is defined in <code>macros.njk</code>,</p><pre class="language-liquid"><code class="language-liquid">{{ macros.demo(arguments) }}</code></pre><p>For an example of using this approach,<br>see how <code>_includes/layout.njk</code> uses macros to render the left nav.</p><p>A <code>call</code> block enables passing enclosed text to a macro.</p><p>TODO: Maybe Nunjucks macros can be used as an alternative to 11ty shortcodes.</p><h2>Template inheritance</h2><p>Blocks define named locations in a template where content can be inserted.<br>They can contain default content that a using template can override.</p><p>The <code>extends</code> tag inherits another template.<br>This is followed by <code>block</code> tags that supply content to be inserted.</p><p>The <code>super</code> function is used in conjunction with template inheritance<br>to render the contents of a parent block.</p><p>For more detail, see<br><a href="https://mozilla.github.io/nunjucks/templating.html#template-inheritance">Template Inheritance</a>.</p><h2>Whitespace</h2><p>By default all whitespace is retained.<br>To trim whitespace before a construct, begin with <code>{%-</code> instead of <code>{%</code>.<br>To trim whitespace after a construct, end with <code>-%}</code> instead of <code>%}</code>.<br>Zach Leatherman recommends only using <code>{%-</code>.</p><h2>Global functions</h2><p>Nunjucks provides some predefined functions that address common needs.</p><ul><li><code>range</code> is used to iterate over a range of integer values.</li><li><code>cycler</code> rotates through a set of values.</li><li><code>joiner</code> returns a function that outputs a given string<br>each time it is called except for the first.</li></ul><h2>Documenting Nunjucks syntax</h2><p>To escape Nunjucks syntax so it is rendered as-is instead of being evaluated,<br>wrap it in a <code>raw</code> block.<br>It may also be desirable to wrap the text in a Markdown fenced block.<br>There is no support for Nunjucks syntax, but Liquid syntax is close enough.<br>In the example below, the apostrophe characters should really be backticks.</p><pre class="language-liquid"><code class="language-liquid">{<span class="token operator">%</span> <span class="token keyword">raw</span> <span class="token operator">%</span>}<br>'''liquid<br>Some Nunjucks syntax goes here.<br>'''<br>{<span class="token operator">%</span> <span class="token keyword">endraw</span> <span class="token operator">%</span>}<br></code></pre><p><code>verbatim</code> is an alias for <code>raw</code>.</p>