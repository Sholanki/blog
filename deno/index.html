<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Deno</h2><aside><nav class="toc"><ol><li><a href="#differences-from-node.js">Differences from Node.js</a></li><li><a href="#standard-library">Standard Library</a></li><li><a href="#pros">Pros</a></li><li><a href="#cons">Cons</a></li><li><a href="#installing">Installing</a></li><li><a href="#linting">Linting</a></li><li><a href="#code-formatting">Code Formatting</a></li><li><a href="#imports">Imports</a></li><li><a href="#deno.land">deno.land</a></li><li><a href="#version">Version</a></li><li><a href="#running">Running</a></li><li><a href="#permission-options">Permission Options</a></li><li><a href="#implementing-a-rest-server">Implementing a REST Server</a></li></ol></nav></aside><article><p><a href="https://deno.land/" rel="noopener" target="_blank">Deno</a> is a &quot;secure runtime for JavaScript and TypeScript&quot;.</p><p>Ryan Dahl created both <a href="https://nodejs.org/" rel="noopener" target="_blank">Node.js</a> and Deno. In June 2018, he gave a talk at JSConf EU 2018 titled &quot;10 Things I Regret About Node.js&quot;. A prototype of Deno was presented during this talk.</p><p>Deno has builtin support for TypeScript. It automatically compiles TypeScript code to JavaScript before running it, making it unnecessary to define a build process to do this.</p><p>Both Node.js and Deno are built on the Chrome V8 JavaScript engine. Node.js is primarily implemented in C++. Deno was originally implemented in Go and later changed to Rust.</p><p>Version 1.0 of Deno was released on May 13, 2020. It is open source and uses the MIT license.</p><p>Deno is secure by default. The environment, file system, and network can only be accessed if explicitly enabled.</p><p>To get started and find documentation, see the <a href="https://deno.land/manual" rel="noopener" target="_blank">Deno Manual</a>.</p><h2 id="differences-from-node.js">Differences from Node.js</h2><ol><li>Deno uses ES Modules by default. Node.js can use ES Modules, but defaults to CommonJS.</li><li>Deno uses URLs for loading remote dependencies rather than relative paths in the <code>node_modules</code> directory.</li><li>Deno uses built-in resource fetching rather than relying on npm to install packages.</li><li>Deno has built-in TypeScript support with caching of compile source files.</li><li>Deno requires file system and network access to be explicitly enabled.</li><li>Deno APIs utilize Promises, ES6, and TypeScript features.</li><li>Deno provides a large standard library with no external dependencies.</li><li>Deno uses message passing channels to invoke privileged system APIs.</li></ol><h2 id="standard-library">Standard Library</h2><p>The standard library of Deno is modeled after that of the Go programming language.</p><h2 id="pros">Pros</h2><h2 id="cons">Cons</h2><h2 id="installing">Installing</h2><p>To install Deno:</p><ul><li>for Windows, use Chocolately: <code>choco install deno</code></li><li>for macOS, use Homebrew: <code>brew install deno</code></li><li>for Linux, use curl: <code>curl -fsSL https://deno.land/x/install/install.sh | sh</code></li></ul><h2 id="linting">Linting</h2><h2 id="code-formatting">Code Formatting</h2><h2 id="imports">Imports</h2><p>Deno does not use npm to install modules. Instead, <code>import</code> statements can specify module URLs that reference network resources such as those in GitHub.</p><p>Imported files are cached by saving them in the directory specified in the <code>DENO_DIR</code> environment variable rather than in a <code>node_modules</code> directory. If this environment variable is not set, the files are saved in an OS-specific location.</p><ul><li>Windows: <code>%LOCALAPPDATA%/deno</code></li><li>macOS: <code>\$HOME/Library/Caches/deno</code></li><li>Linux: <code>\$XDG_CACHE_HOME/deno</code> or <code>\$HOME/.cache/deno</code></li></ul><p>Dependencies are not cataloged in a <code>package.json</code> file, which is not used at all. TODO: How do you script common actions?</p><p>Spreading library URLs throughout the source files of a project can be undesirable, especially of some are repeated in multiple files. An alternate approach is to create a file like <code>src/deps.ts</code> (recommended name) containing lines like the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token punctuation">{</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">,</span> name3<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://domain1/pkg1@v1/filename1.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token punctuation">{</span>name4<span class="token punctuation">,</span> name5<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://domain2/pkg2@v2/filename2.ts'</span><span class="token punctuation">;</span></code></pre><p>Then import from this file with lines like the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>name1<span class="token punctuation">,</span> name3<span class="token punctuation">,</span> name4<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./deps.ts'</span><span class="token punctuation">;</span></code></pre><p>It is useful to record the version of each dependency being used so the same versions can be downloaded by multiple developers and in CI/CD environments. A lock file does just this. Assuming all dependencies are exported from the file <code>src/deps.ts</code>, enter the following command to create a lock file named <code>lock.json</code>.</p><pre class="language-bash"><code class="language-bash">deno cache --lock<span class="token operator">=</span>lock.json --lock-write src/deps.ts</code></pre><p>Add the lock file to version control.</p><p>To install all the dependency versions specified in a lock file, enter the following command:</p><pre class="language-bash"><code class="language-bash">deno cache --reload --lock<span class="token operator">=</span>lock.json src/deps.ts</code></pre><p>The cached files continue to be used without checking whether dependencies have been updated. To update the cached files to their latest versions, enter <code>deno cache --reload</code>.</p><p>To update a single module to a specific version, enter a command like the following:</p><pre class="language-bash"><code class="language-bash">deno cache --reload<span class="token operator">=</span>https://some-domain/some-module@version main.ts</code></pre><p>After doing this, the lock file can be updated by entering the command for creating it that was described earlier.</p><p>To run a Deno program using only cached modules, preventing any new downloads, enter a command like the following:</p><pre class="language-bash"><code class="language-bash">deno run --lock<span class="token operator">=</span>lock.json --cached-only main.ts</code></pre><p>This will fail if any source file imports a module with a URL that has not previously been cached.</p><h2 id="deno.land">deno.land</h2><p>The site <code>https://deno.land/x</code> hosts a curated collection of third-party modules that work with Deno. As of 11/23/2020 it contained 1,302 modules. Examples include lodash, date_fns, ramda, xstate, ky (HTTP client), and i18next (internationalization framework).</p><h2 id="version">Version</h2><p>Enter <code>deno -V</code> to output the Deno version.</p><p>Enter <code>deno --version</code> to output the versions of Deno, V8, and TypeScript.</p><h2 id="running">Running</h2><p>To run a Deno program, enter a command like the following:</p><pre class="language-bash"><code class="language-bash">deno run src/main.ts</code></pre><p>To run in watch mode, add the currently unstable watch option. For example:</p><pre class="language-bash"><code class="language-bash">deno run --allow-net --unstable --watch my-server.ts</code></pre><p>When a file change is detected, the program is restarted, but no output is generated to indicate that this happened.</p><h2 id="permission-options">Permission Options</h2><p>Deno supports the following permission options:</p><ul><li><code>-A</code> or <code>--allow-all</code><br>This allow all permissions, disabling all security.</li><li><code>--allow-env</code><br>This allows getting and setting environment variables.</li><li><code>--allow-hrtime</code><br>This allows use of high-resolution time measurement which can be used in timing attacks and fingerprinting.</li><li><code>--allow-net=&lt;allow-net&gt;</code><br>This allows network access. A comma-separated list of domains can optionally be specified to restrict network access to only those domains.</li><li><code>--allow-plugin</code><br>This allows plugins to be loaded. It is currently an unstable feature.</li><li><code>--allow-read=&lt;allow-read&gt;</code><br>This allows read access to the file system. A comma-separated list of directories or files can optionally be specified to restrict reads to only those directories and files.</li><li><code>--allow-run</code><br>This allow running subprocesses outside of the Deno sandbox, which means they do not have security restrictions.</li><li><code>--allow-write=&lt;allow-write&gt;</code><br>This allows write access to the file system. A comma-separated list of directories or files can optionally be specified to restrict writes to only those directories and files.</li></ul><h2 id="implementing-a-rest-server">Implementing a REST Server</h2><p>TODO: Finish this.</p></article>