<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><link rel="stylesheet" href="/blog/assets/github-extensions.css"><h2></h2><h2>Introduction</h2><p>D3 (<a href="https:/">https:/</a>/d3js.org&gt;) stands for Data-Driven Documents. It renders, and re-renders, HTML elements (including <code>svg</code>) in a web browser based on data and changes to the data. D3 is primarily used for data visualizations such as bar charts, pie charts, line charts, scatter plots, geographic maps, and more. But as we will see, it has quite a bit of overlap with jQuery and can be used for many kinds of DOM manipulations that are not related to data visualization.</p><p>So why should I write about D3 now. After all, it has been around for since February 2011. Many tutorial articles already exist. But many of those describe older versions of D3 and each major version included breaking changes. Version 5 of D3 was released in January, 2018. So this is my chance to write an up-to-date D3 tutorial and try to make it very easily to understand. Of course you will be the judge of whether I am successful.</p><p>JavaScript has been my primary programming language for the entirety of the life of D3. I have know of its existence for quite a while, but have ignored it because I was more focused on other JavaScript-based topics including jQuery, Angular, React, Vue, Svelte, and TypeScript. It was time for me to stop ignoring D3 and dig in.</p><p>D3 was created by Mike Bostock, along with other contributors. It is open source and uses a BSD license.</p><p>D3 uses HTML, CSS, JavaScript, the DOM, and SVG, so knowledge of those topics is helpful. To see examples of using D3, click the &quot;Examples&quot; link near the top of <a href="https://d3.js.org">https://d3.js.org</a>.</p><p>There are 3 levels of D3 usage, using higher-level libraries, copying and modifying examples, and coding from scratch.</p><p>An example of a library that uses D3 is C3 (<a href="https://c3js.org/">https://c3js.org/</a>). It uses D3 under the hood to render many kinds of charts. These charts are customizable, but not to the extent that coding from scratch provides. But charts can be implemented quickly this way and the requirement to have deep knowledge of D3 is removed. They respond well to changes in data, including transitions from old to new values.</p><p>There are many sites that provided examples of charts implemented with D3. Perhaps you can find an example that almost exactly what you want. Copying and customizing the code will often require far less time than implementing a chart from scratch.</p><p>My hope is that by the time you finish reading this article, you will know enough about D3 to enable a final option which is implementing an entire chart from scratch. This provides the most flexibility, but requires the most effort.</p><p>The D3 JavaScript API uses CSS selectors to find elements in the DOM that it modifies. It also provides methods to append elements and text nodes, set attributes, and modify text content. In this respect it has overlap with jQuery functionality.</p><p>The functionality of D3 is divided into modules. A default build includes a collection of commonly used modules. Custom builds can omit unneeded modules and add ones not in the default build in order to minimize the amount of code that must be downloaded to browsers.</p><p>These modules include:</p><ul><li>Arrays</li><li>Axes</li><li>Brushes</li><li>Chords</li><li>Collections (Objects, Maps, Sets, Nests)</li><li>Colors</li><li>Color Schemes</li><li>Contours</li><li>Dispatches</li><li>Dragging</li><li>Delimiter-Separated Values</li><li>Easings</li><li>Fetches</li><li>Forces</li><li>Number Formats</li><li>Geographies</li><li>Hierarchies</li><li>Interpolators</li><li>Paths</li><li>Polygons</li><li>Quadtrees</li><li>Random Numbers</li><li>Scales</li><li>Selections</li><li>Shapes</li><li>Time Formats</li><li>Time Intervals</li><li>Timers</li><li>Transitions</li><li>Voronoi Diagrams</li><li>Zooming</li></ul><p>Let's learn D3 by example. Many D3 tutorials start with a bar chart and so will we. But ours will include more features than typically shown in tutorials in order to introduce more D3 concepts.</p><p>You are encouraged to copy the code in the article and try it in a web browser!</p><h3>SVG Basics</h3><p>SVG stands for Scalable Vector Graphics. It is an XML-based syntax for specifying vector graphics and is supported by all modern web browsers.</p><p>SVG elements include <code>svg</code>, <code>line</code>, <code>polygon</code>, <code>rect</code>, <code>circle</code>, <code>path</code>, <code>text</code>, <code>image</code>, <code>g</code> (for group), and many more. For our bar chart will will only need <code>svg</code>, <code>g</code>, <code>rect</code>, and <code>text</code>.</p><p>Let's get started by drawing a rectangle and putting some text on it.</p><p><img src="/blog/assets/d3-svg-demo.png" alt="D3 SVG demo"></p><h3><code>svg-demo.html</code></h3><pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 SVG Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>D3 SVG Demo<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./svg-demo.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./svg-demo.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3><code>svg-demo.css</code></h3><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.bar > rect</span> <span class="token punctuation">{</span><br>  <span class="token property">stroke</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><br>  <span class="token property">stroke-width</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.bar > text</span> <span class="token punctuation">{</span><br>  <span class="token property">fill</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br>  <span class="token property">text-anchor</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span> <span class="token comment">/* horizontally centers */</span><br><span class="token punctuation">}</span><br><br><span class="token selector">#chart</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3><code>svg-demo.js</code></h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">HEIGHT</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">WIDTH</span> <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> score <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// out of 10</span><br><span class="token keyword">const</span> barHeight <span class="token operator">=</span> <span class="token constant">HEIGHT</span> <span class="token operator">*</span> <span class="token punctuation">(</span>score <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> barWidth <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> svg <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token constant">WIDTH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> group <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>group<br>  <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> barHeight<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> barWidth<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span> <span class="token operator">-</span> barHeight<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token string">'cornflowerblue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>group<br>  <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> barWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// center horizontally in bar</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span> <span class="token operator">-</span> barHeight <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// just below top</span></code></pre><h2>D3 Selection Objects</h2><p>A D3 selection object encapsulates a set of DOM elements, similar to a jQuery object. To create one, use the d3 methods <code>select</code> and <code>selectAll</code>. For example, <code>d3.select('.bar')</code> returns a selection object that encapsulates the first element in the DOM with a CSS class of &quot;bar&quot;. <code>d3.selectAll('.bar')</code> is similar, but the returned selection object encapsulates all the matching DOM elements.</p><p>The <code>select</code> and <code>selectAll</code> methods can also be called on a selection to find elements that are descendants of the elements in the selection within the DOM tree.</p><p>Here is an example that demonstrates using the <code>select</code> and <code>selectAll</code> methods.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 Selections<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Bar #1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Bar #2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Bar #3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Bar #4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Bar #5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token keyword">const</span> bars1 <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bars1 ='</span><span class="token punctuation">,</span> bars1<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> chart1 <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#chart1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> bars2 <span class="token operator">=</span> chart1<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bars2 ='</span><span class="token punctuation">,</span> bars2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> charts <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.chart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> bars3 <span class="token operator">=</span> charts<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bars3 ='</span><span class="token punctuation">,</span> bars3<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Here is the output from the <code>console.log</code> calls found in the DevTools console.</p><p><img src="/blog/assets/d3-selections-in-console.png" alt="selection objects in console"></p><p>Each selection object has the following properties:</p><ul><li><code>_parents</code> This is an array of the DOM elements that were searched When the <code>select</code> and <code>selectAll</code> methods are called on the <code>d3</code> object, this array will contain only the <code>html</code> element of the current document. When these methods are called on an existing selection, this array will contain all the DOM elements in that selection.</li><li><code>_groups</code> This is an array of DOM NodeList objects, one per parent element. These NodeList objects contain the matching DOM elements.</li></ul><p>In the <code>bars1</code> selection, <code>_parents</code> contains only the <code>html</code> element, indicating that the entire document was searched. <code>_groups</code> holds a single <code>NodeList</code> that contains every DOM element with a CSS class of &quot;bar&quot;.</p><p>In the <code>bars2</code> selection, <code>_parents</code> contains only the element with an id of &quot;chart1&quot;. This happens because the search was performed on a selection that only contains that element. <code>_groups</code> holds a single <code>NodeList</code> that only contains the DOM elements with a CSS class of &quot;bar&quot; that are descendants of the element with an id of &quot;chart1&quot;.</p><p>In the <code>bars3</code> selection, <code>_parents</code> contains the two elements with a CSS class of &quot;chart&quot; because the search was performed on a selection that only contains those elements. <code>_groups</code> holds two <code>NodeList</code> objects, one for each parent element. Each of these contains the DOM elements with a CSS class of &quot;bar&quot; that are descendants of their respective parent element.</p><h2>The <code>data</code> method</h2><p>Selection objects have a <code>data</code> method that associates data in an array with the DOM elements in the selection. It does this by adding a <code>__data__</code> property to them.</p><p>Here is an example that demonstrates calling the <code>data</code> method on a selection.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 data method<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> bars <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bars ='</span><span class="token punctuation">,</span> bars<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>Here is the output from the <code>console.log</code> call found in the DevTools console.</p><p><img src="/blog/assets/d3-selection-from-data.png" alt="selection from data method in console"></p><p>If the values in the array passed to the <code>data</code> method are objects, a second argument which is a function can be passed. This is responsible for extracting or computing a value from each object in the array. For example, suppose we have an array in a variable names <code>paintings</code> that contains objects that describe paintings and they have properties like <code>paintingName</code>, <code>width</code>, and <code>height</code>. We can use the area of each painting as the values as follows:</p><pre class="language-js"><code class="language-js">someSelection<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>paintings<span class="token punctuation">,</span> <span class="token parameter">p</span> <span class="token operator">=></span> p<span class="token punctuation">.</span>width <span class="token operator">*</span> p<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>data</code> method returns a new selection that contains three sub-selections referred to as &quot;update&quot;, &quot;enter&quot;, and &quot;exit&quot;.</p><p>The update sub-selection is held in the <code>_groups</code> property and contains all the DOM elements in the selection that can be <em>updated</em> with a data value.</p><p>The enter sub-selection is held in the <code>_enter</code> property and contains a placeholder for each DOM element that must be created in order to associated a data value. These elements will <em>enter</em> the DOM. Note the <code>__data__</code> property values in each of these placeholder objects.</p><p>The &quot;exit&quot; sub-selection is held in the <code>_exit</code> property and contains all the DOM elements in the selection for which no data will be assigned. Typically these elements <em>exit</em> the DOM by being removed.</p><p>There are three scenarios to consider.</p><ol><li>There are no DOM elements in the selection.</li><li>There are DOM elements in the selection, but fewer than the number of data values.</li><li>There are DOM elements in the selection, but more than the number of data values.</li></ol><p>We have already seen the first scenario in previous code example.</p><p>To see the second scenario, add the following to the HTML.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>Reloading the page in the browser, we see that the update sub-selection holds these two elements with the values 7 and 13. The enter sub-selection now contains a single placeholder with the value 2. The exit sub-selection is empty.</p><p>To see the third scenario, add three more <code>div</code> elements with a class of &quot;bar&quot; so there are a total of five. Reloading the page in the browser, we see that the update sub-selection holds three elements with the values 7, 13, and 2. The enter sub-selection is empty. The exit sub-selection holds two elements that can be removed.</p><p>In order to support changing data, both values and the number of values, we need to handle all three sub-selections. This means we need a way to iterate over the elements in each.</p><p>To iterate over all the elements in the update sub-selection call methods such as <code>text</code> directly on the selection object. To get the enter sub-selection, call the <code>enter</code> method. To get the exit sub-selection, call the <code>exit</code> method.</p><p>The following example demonstrates each of these. It generates an array containing a random number of random integers. These are used to display values in <code>div</code> elements that have a CSS class of &quot;bar&quot;. Their text indicate whether the element was updated or just entered the DOM. Each time the &quot;Update&quot; button is pressed, the process repeats and previously created <code>div</code> elements are reused.</p><p>Selection objects support many methods, some which act on all the DOM elements they encapsulate. An example used in the code below is the <code>text</code> method. These methods take a function that is invoked once for each encapsulated DOM element. The function is passed the value of the DOM element <strong>data</strong> property and the index of the DOM element within the selection. Just like in jQuery, it is not an error to call such a method on a selection that is empty, meaning it doesn't encapsulate any DOM elements.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 data method<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>update()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Update<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token comment">// Gets a random integer between 1 and max inclusive.</span><br>      <span class="token keyword">const</span> <span class="token function-variable function">randomInt</span> <span class="token operator">=</span> <span class="token parameter">max</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><br><br>      <span class="token comment">// Generates an array containing a random number of random integers.</span><br>      <span class="token keyword">function</span> <span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> values<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'values ='</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Create a D3 selection representing the bars</span><br>        <span class="token comment">// which are div elements with a CSS class of "bar"</span><br>        <span class="token comment">// and associate data values with them.</span><br>        <span class="token keyword">const</span> bars <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Update the text of .bar elements that are already in the DOM.</span><br>        bars<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token string">'update '</span> <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Create new .bar elements that need to enter the DOM</span><br>        <span class="token comment">// and set their text.</span><br>        bars<br>          <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token string">'enter '</span> <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Remove .bar elements that need to exit the DOM.</span><br>        bars<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// initial call</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>This is a common D3 pattern referred to as the &quot;general update pattern&quot;. It can be simplified in a couple of ways.</p><p>The first simplification is the use the <code>merge</code> method. This is called after appending elements to the enter sub-selection. It creates a new selection by combining elements in the selection on which it is called (the enter sub-selection in this case) with the selection passed to it (the update sub-selection in this case). The call that follow this operates on this new selection. This approach allows us to replace the &quot;Update&quot; and &quot;Create&quot; sections above with the following:</p><pre class="language-js"><code class="language-js">bars<br>  <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns the enter sub-selection</span><br>  <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span> <span class="token comment">// returns the enter sub-selection</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span> <span class="token comment">// returns the enter sub-selection</span><br>  <span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>bars<span class="token punctuation">)</span> <span class="token comment">// returns a new selection</span><br>  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token string">'value '</span> <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>We have lost the ability to specify different text for updated and entered elements, but that is not typically needed.</p><h2>The <code>join</code> method</h2><p>A second simplification that can be made to the code above is to use the <code>join</code> method. This takes three functions, one to handle each sub-selection. They must be in the order enter, update, and exit. Using this approach, the code above, including the code for handling the exit sub-selection, can be replaced by the following.</p><pre class="language-js"><code class="language-js">bars<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><br>  <span class="token parameter">enter</span> <span class="token operator">=></span><br>    enter<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token string">'enter '</span> <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token parameter">update</span> <span class="token operator">=></span> update<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token string">'update '</span> <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token comment">// This is the default behavior for the exit sub-selection</span><br>  <span class="token comment">// and can be omitted.</span><br>  <span class="token parameter">exit</span> <span class="token operator">=></span> exit<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This regains the ability to have different text for updated and entered elements. But if that is not needed, we can shorten the code even more like this:</p><pre class="language-js"><code class="language-js">bars<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token parameter">enter</span> <span class="token operator">=></span><br>  enter<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token string">'value '</span> <span class="token operator">+</span> d<span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>We can even take this one step farther and pass the name of the element to be created for each element in the enter sub-selection like this:</p><pre class="language-js"><code class="language-js">bars<br>  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token string">'value '</span> <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2>More on selection objects</h2><p>There are many methods on selection objects that iteration over the elements in the NodeList values found in the <code>_groups</code> array. These include <code>attr</code>, <code>text</code>, and many more. A function is passed to these methods that is passed the value of the <code>__data__</code> property of the current element and its index within the selection. Inside these function, the current element can be access using the <code>this</code> keyword. In order to use <code>this</code>, the function must not be an arrow function.</p><p>Selection objects are immutable, meaning the set of DOM elements they encapsulate cannot be changed. However, there are many methods on selection objects that return a new selection, including <code>map</code> and <code>filter</code>.</p><p>If you're feeling somewhat comfortable now with the notion of selection objects, their three sub-selections, and the general update pattern, you are ready to put that knowledge to use for creating your first chart.</p><h2>Drawing Bars</h2><p>Earlier we learned how to draw a single bar. Let's combine that with what we have learned about selections to draw one bar for each piece of data in an array. We will create a bar chart like the following:</p><p><img src="/blog/assets/bar-chart.png" alt="D3 Bar Chart"></p><p>To see this in action, browse <a href="https://bar-chart.vercel.app/" target="_blank">Bar Chart on Vercel</a>.</p><p>The &quot;Update&quot; button generates new, random data and updates the bars. This is implemented by the files <code>index.html</code>, <code>bar-chart.css</code>, and <code>bar-chart.js</code> which are shown below.</p><p>This code gives us a good base for adding features. There are many D3 concepts to cover here. See comments in the code for details.</p><h3><code>index.html</code></h3><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 Bar Chart<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>D3 Bar Chart<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./bar-chart.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./bar-chart.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token comment">&lt;!-- The bars will be added in this svg element. --></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><br>      <span class="token comment">&lt;!-- Render a new version of the chart when this is pressed. --></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>updateData()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Update<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3><code>bar-chart.css</code></h3><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.bar > rect</span> <span class="token punctuation">{</span><br>  <span class="token property">stroke</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><br>  <span class="token property">stroke-width</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">button</span> <span class="token punctuation">{</span><br>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">#chart</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3><code>bar-chart.js</code></h3><pre class="language-js"><code class="language-js"><span class="token comment">// Later these will be adjusted to make room</span><br><span class="token comment">// for a vertical and horizontal axis.</span><br><span class="token keyword">const</span> <span class="token constant">BOTTOM_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">LEFT_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">RIGHT_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><br><span class="token comment">// Full size of the svg element.</span><br><span class="token keyword">const</span> <span class="token constant">HEIGHT</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">WIDTH</span> <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span><br><br><span class="token comment">// Size that can be used for the bars.</span><br><span class="token keyword">const</span> usableHeight <span class="token operator">=</span> <span class="token constant">HEIGHT</span> <span class="token operator">-</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">-</span> <span class="token constant">BOTTOM_PADDING</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> usableWidth <span class="token operator">=</span> <span class="token constant">WIDTH</span> <span class="token operator">-</span> <span class="token constant">LEFT_PADDING</span> <span class="token operator">-</span> <span class="token constant">RIGHT_PADDING</span><span class="token punctuation">;</span><br><br><span class="token comment">// Random data will be selected from this array.</span><br><span class="token keyword">const</span> allData <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'banana'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'cherry'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'date'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'grape'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'mango'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'peach'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'raspberry'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'strawberry'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'tangerine'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'watermelon'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> barPadding<span class="token punctuation">,</span> barWidth<span class="token punctuation">,</span> xScale<span class="token punctuation">,</span> yScale<span class="token punctuation">;</span><br><br><span class="token comment">// This is used to select bar colors based on their score.</span><br><span class="token keyword">const</span> colorScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleOrdinal</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span>schemePaired<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12 colors</span><br><br><span class="token comment">// This returns a random integer from 1 to max inclusive.</span><br><span class="token keyword">const</span> <span class="token function-variable function">random</span> <span class="token operator">=</span> <span class="token parameter">max</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// This returns an array of objects taken from allData.</span><br><span class="token comment">// A "score" property with a random value from 1 to 10</span><br><span class="token comment">// is added to each object.</span><br><span class="token keyword">function</span> <span class="token function">getRandomData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">random</span><span class="token punctuation">(</span>allData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> shuffled <span class="token operator">=</span> allData<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">0.5</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> shuffled<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  data<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f1<span class="token punctuation">,</span> f2</span><span class="token punctuation">)</span> <span class="token operator">=></span> f1<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    item<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> data<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This updates the attributes of an SVG rect element</span><br><span class="token comment">// that represents a bar.</span><br><span class="token keyword">function</span> <span class="token function">updateRect</span><span class="token punctuation">(</span><span class="token parameter">rect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  rect<br>    <span class="token comment">// Each fruit will keep the same color as its score changes.</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token function">colorScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>colorIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> barWidth <span class="token operator">-</span> barPadding <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> usableHeight <span class="token operator">-</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> barPadding<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This updates the bar chart with random data.</span><br><span class="token keyword">function</span> <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">getRandomData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Calculate padding on sides of bars based on # of bars.</span><br>  barPadding <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Calculate the width of each bar based on # of bars.</span><br>  barWidth <span class="token operator">=</span> usableWidth <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a scale to map data index values to x coordinates.</span><br>  <span class="token comment">// This is a function that takes a value in the "domain"</span><br>  <span class="token comment">// and returns a value in the "range".</span><br>  xScale <span class="token operator">=</span> d3<br>    <span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">LEFT_PADDING</span><span class="token punctuation">,</span> <span class="token constant">LEFT_PADDING</span> <span class="token operator">+</span> usableWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a scale to map data score values to y coordinates.</span><br>  <span class="token comment">// The range is flipped to account for</span><br>  <span class="token comment">// the SVG origin being in the upper left corner.</span><br>  <span class="token comment">// Like xScale, this is a function that takes a value in the "domain"</span><br>  <span class="token comment">// and returns a value in the "range".</span><br>  <span class="token comment">// The d3.max function computes the largest data value in a given array</span><br>  <span class="token comment">// where values are computed by the 2nd argument function.</span><br>  <span class="token keyword">const</span> max <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  yScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> max<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>usableHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a D3 selection object that represents the svg element</span><br>  <span class="token comment">// and set the size of the svg element.</span><br>  <span class="token keyword">const</span> svg <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token constant">WIDTH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// This is the most critical part to understand!</span><br>  <span class="token comment">// You learned about about selections and the general update pattern</span><br>  <span class="token comment">// in the previous section.</span><br>  <span class="token keyword">const</span> groups <span class="token operator">=</span> svg<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token parameter">enter</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// Create a new SVG group element for each placeholder</span><br>      <span class="token comment">// to represent a new bar.</span><br>      <span class="token comment">// For now the only thing in each group will be a rect element,</span><br>      <span class="token comment">// but later we will add a text element to display the value.</span><br>      <span class="token keyword">const</span> groups <span class="token operator">=</span> enter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token comment">// Create a new SVG rect element for each group.</span><br>      groups<br>        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> usableHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">return</span> groups<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// The join method call above returns a selection that combines</span><br>  <span class="token comment">// the update and enter sub-selections into its update selection.</span><br>  <span class="token comment">// This allows operations needed on elements in both</span><br>  <span class="token comment">// to be performed on the new selection.</span><br><br>  <span class="token comment">// Translate the groups for each bar to their</span><br>  <span class="token comment">// appropriate x coordinate based on its index.</span><br>  groups<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">xScale</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 0)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Update all the rect elements using their newly associated data.</span><br>  groups<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>updateRect<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Render the first version of the chart.</span><br><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2>Adding Y Axis</h2><p>Now let's add a y axis to the chart the indicates the bar values. We want this to be dynamic so that the highest value matches the highest value of any of the bars that are present.</p><p>Here are the steps:</p><ol><li><p>Increase the value of <code>LEFT_PADDING</code> from 10 to 25 to leave room for the y axis.</p></li><li><p>Add the variable <code>yAxisGroup</code> to the <code>let</code> statement near the top as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> barPadding<span class="token punctuation">,</span> barWidth<span class="token punctuation">,</span> xScale<span class="token punctuation">,</span> yAxisGroup<span class="token punctuation">,</span> yScale<span class="token punctuation">;</span></code></pre></li><li><p>Add the function <code>updateYAxis</code> shown below:</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updateYAxis</span><span class="token punctuation">(</span><span class="token parameter">svg<span class="token punctuation">,</span> data<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>yAxisGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Create an SVG group that will hold the y axis and</span><br>    <span class="token comment">// translate the group to the appropriate position in the SVG.</span><br>    yAxisGroup <span class="token operator">=</span> svg<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'y-axis'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">LEFT_PADDING</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">TOP_PADDING</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Create an array with values from zero to max</span><br>  <span class="token comment">// that will be used as the tick values on the y axis.</span><br>  <span class="token keyword">const</span> tickValues <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">Array</span><span class="token punctuation">(</span>max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create an axis generator function that renders the yAxis.</span><br>  <span class="token keyword">const</span> yAxis <span class="token operator">=</span> d3<br>    <span class="token punctuation">.</span><span class="token function">axisLeft</span><span class="token punctuation">(</span>yScale<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">tickValues</span><span class="token punctuation">(</span>tickValues<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">tickFormat</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=></span> n<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Pass the selection for the group to the</span><br>  <span class="token comment">// axis generator function to render it.</span><br>  <span class="token function">yAxis</span><span class="token punctuation">(</span>yAxisGroup<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// An equivalent way to do this is yAxisGroup.call(yAxis);</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following at the bottom of the <code>updateData</code> function:</p><pre class="language-js"><code class="language-js"><span class="token function">updateYAxis</span><span class="token punctuation">(</span>svg<span class="token punctuation">,</span> data<span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ol><p>The result looks like this:</p><p><img src="/blog/assets/d3-bar-chart-with-y-axis.png" alt="D3 bar chart with y axis"></p><h2>Adding X Axis</h2><p>Now let's add an x axis to the chart whose values are labels associated with each bar. In our example the labels are names of fruits and the values represent scores in a poll where respondents name their favorite fruit. Of course all our data is randomly generated.</p><p>Here are the steps:</p><ol><li>Add the following to <code>bar-chart.css</code> to position and rotate the x-axis labels:</li></ol><pre class="language-css"><code class="language-css"><span class="token selector">.x-axis > .tick > text</span> <span class="token punctuation">{</span><br>  <span class="token comment">/* Rotate labels so they fit below bars better. */</span><br>  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-8px<span class="token punctuation">,</span> 15px<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-45deg<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><ol><li><p>Increase the value of <code>BOTTOM</code> from 10 to 50 to leave room for the x axis.</p></li><li><p>Add the variable <code>yAxisGroup</code> to the <code>let</code> statement near the top as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> barPadding<span class="token punctuation">,</span> barWidth<span class="token punctuation">,</span> xAxisGroup<span class="token punctuation">,</span> xScale<span class="token punctuation">,</span> yAxisGroup<span class="token punctuation">,</span> yScale<span class="token punctuation">;</span></code></pre></li><li><p>Add the function <code>updateXAxis</code> shown below:</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updateXAxis</span><span class="token punctuation">(</span><span class="token parameter">svg<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>xAxisGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Create the x-axis that displays fruit names.</span><br>    xAxisGroup <span class="token operator">=</span> svg<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'x-axis'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(0, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> usableHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> xAxisScale <span class="token operator">=</span> d3<br>    <span class="token punctuation">.</span><span class="token function">scaleBand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// fruit names</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">LEFT_PADDING</span><span class="token punctuation">,</span> <span class="token constant">LEFT_PADDING</span> <span class="token operator">+</span> usableWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> xAxis <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">axisBottom</span><span class="token punctuation">(</span>xAxisScale<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">xAxisGroup</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>xAxis<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following at the bottom of the <code>updateData</code> function:</p><pre class="language-js"><code class="language-js"><span class="token function">updateXAxis</span><span class="token punctuation">(</span>svg<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ol><p>The result looks like this:</p><p><img src="/blog/assets/d3-bar-chart-with-x-axis.png" alt="D3 bar chart with x axis"></p><h2>Adding Text on Bars</h2><p>Now let's add the value of each bar as text that is positioned near the top of each bar.</p><p>The bars have a variety of fill colors. Using white text will look good on top of some colors, but using black text is better for others. We can choose between white and black text by calculating the relative luminance of the bar fill color. A formula for this can be found in Wikipedia at <a href="https://en.wikipedia.org/wiki/Relative_luminance">https://en.wikipedia.org/wiki/Relative_luminance</a>. This is used in the <code>getTextColor</code> function below.</p><p>Here are the steps:</p><ol><li><p>Add the following CSS rule in <code>bar-chart.css</code> to center the text for a bar horizontally within the bar.</p><pre class="language-css"><code class="language-css"><span class="token selector">.bar > text</span> <span class="token punctuation">{</span><br>  <span class="token property">text-anchor</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following function for choosing the text color to use on a bar with a given fill color.</p><pre class="language-js"><code class="language-js"><span class="token comment">// This returns a text color to use on a given background color.</span><br><span class="token keyword">function</span> <span class="token function">getTextColor</span><span class="token punctuation">(</span><span class="token parameter">bgColor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Convert the hex background color to its decimal components.</span><br>  <span class="token keyword">const</span> red <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>bgColor<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> green <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>bgColor<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> blue <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>bgColor<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Compute the "relative luminance".</span><br>  <span class="token keyword">const</span> luminance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.2126</span> <span class="token operator">*</span> red <span class="token operator">+</span> <span class="token number">0.7152</span> <span class="token operator">*</span> green <span class="token operator">+</span> <span class="token number">0.0722</span> <span class="token operator">*</span> blue<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Use dark text on light backgrounds and vice versa.</span><br>  <span class="token keyword">return</span> luminance <span class="token operator">></span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following function for updating the text for a specific bar:</p><pre class="language-js"><code class="language-js"><span class="token comment">// This updates the attributes of an SVG text element</span><br><span class="token comment">// that displays the score for a bar.</span><br><span class="token keyword">function</span> <span class="token function">updateText</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  text<br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> barColor <span class="token operator">=</span> <span class="token function">colorScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>colorIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> <span class="token function">getTextColor</span><span class="token punctuation">(</span>barColor<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>score<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> barWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// center horizontally in bar</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>score<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// just below top</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following inside the <code>updateData</code> function after the line that appends a <code>rect</code> element to the SVG group for a bar:</p><pre class="language-js"><code class="language-js"><span class="token comment">// Create a new SVG text element for each group.</span><br>groups<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> usableHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following after the call to <code>updateRect</code>:</p><pre class="language-js"><code class="language-js"><span class="token comment">// Update all the text elements using their newly associated data.</span><br>groups<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>updateText<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ol><p>The result looks like this:</p><p><img src="/blog/assets/d3-bar-chart-with-text.png" alt="D3 bar chart with text"></p><p>Note how some bars have white text, while others have black text.</p><h2>Adding Transitions</h2><p>D3 transitions animate changes to DOM and SVG properties.</p><p>Let's add code to animate the following:</p><ul><li>changes to the position, width, and height of bars</li><li>changes to the position of text on bars</li><li>changes to the y-axis</li><li>changes to the x-axis</li><li>bars being removed</li></ul><p>We can define a transition function that applies a specified transition to any selection. This function can be used to add all of the transitions listed above. Ours will only specify a duration for the transitions, but it is also possible to specify an amount of time to delay before the transition begins and an easing function which controls the speed of the transition at various times throughout its duration. When these are not specified, the delay defaults to zero and the easing function defaults to <code>d3.easeCubic</code>. For descriptions of the provided easing functions and graphs that show their effect, see <a href="https://github.com/d3/d3-ease">https://github.com/d3/d3-ease</a>.</p><p>Here are the steps:</p><ol><li><p>Add the following constant:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">DURATION</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span> <span class="token comment">// of transitions</span></code></pre></li><li><p>Add the following function:</p><pre class="language-js"><code class="language-js"><span class="token comment">// You cannot invoke this with the call method on selections</span><br><span class="token comment">// because that will return the selection</span><br><span class="token comment">// instead of the result of the last call made here.</span><br><span class="token keyword">const</span> <span class="token function-variable function">myTransition</span> <span class="token operator">=</span> <span class="token parameter">selection</span> <span class="token operator">=></span> selection<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token constant">DURATION</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>In the <code>updateRect</code> function, replace the first line which is just <code>rect</code> with <code>myTransition(rect)</code>.</p></li><li><p>In the <code>updateText</code> function, replace the first line which is just <code>text</code> with <code>myTransition(text)</code>.</p></li><li><p>Add the following line at the end of the <code>updateXAxis</code> function:</p><pre class="language-js"><code class="language-js">xAxisGroup <span class="token operator">=</span> <span class="token function">myTransition</span><span class="token punctuation">(</span>xAxisGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following line at the end of the <code>updateYAxis</code> function:</p><pre class="language-js"><code class="language-js">yAxisGroup <span class="token operator">=</span> <span class="token function">myTransition</span><span class="token punctuation">(</span>yAxisGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>In the <code>updateData</code> function, currently only one function is passed to the <code>join</code> method. It processes the enter sub-selection. Add two more arguments to the <code>join</code> method using the following code. This processes the exit sub-selection by animate bars leaving the DOM.</p><pre class="language-js"><code class="language-js"><span class="token comment">// This is only needed so we can specify</span><br><span class="token comment">// an exit function as the third argument.</span><br><span class="token parameter">update</span> <span class="token operator">=></span> update<span class="token punctuation">,</span><br>  <span class="token parameter">exit</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// Remove the score text from the</span><br>    <span class="token comment">// exiting rect elements immediately.</span><br>    exit<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Shrink the height of the exiting rects gradually</span><br>    <span class="token comment">// and then remove them them.</span><br>    <span class="token function">myTransition</span><span class="token punctuation">(</span>exit<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> usableHeight<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> exit<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li></ol><p>The result looks the same as before, but now when the &quot;Update&quot; button is pressed, changes to the data cause everything in the bar chart to transition from its previous state to its new state.</p><h2>Conclusion</h2><p>There is much more to learn about D3, including creating more kinds charts such a pie charts and geo charts (maps). What you have learned here about D3 selections and the general update pattern will serve you well as you dig in further.</p><p>Check out the API documentation at <a href="https://github.com/d3/d3/blob/master/API.md">https://github.com/d3/d3/blob/master/API.md</a> TODO: Add more references.</p>