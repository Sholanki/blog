<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><link rel="stylesheet" href="/blog/assets/github-extensions.css"><h2></h2><h2>Introduction</h2><p>D3 (<a href="https:/">https:/</a>/d3js.org&gt;) stands for Data-Driven Documents. It renders, and re-renders, HTML elements (including <code>svg</code>) in a web browser based on data and changes to the data. D3 is primarily used for data visualizations such as bar charts, pie charts, line charts, scatter plots, geographic maps, and more. But as we will see, it has quite a bit of overlap with jQuery and can be used for many kinds of DOM manipulations that are not related to data visualization.</p><p>So why should I write about D3 now. After all, it has been around for since February 2011. Many tutorial articles already exist. But many of those describe older versions of D3 and each major version included breaking changes. Version 5 of D3 was released in January, 2018. So this is my chance to write an up-to-date D3 tutorial and try to make it very easily to understand. Of course you will be the judge of whether I am successful.</p><p>JavaScript has been my primary programming language for the entirety of the life of D3. I have know of its existence for quite a while, but have ignored it because I was more focused on other JavaScript-based topics including jQuery, Angular, React, Vue, Svelte, and TypeScript. It was time for me to stop ignoring D3 and dig in.</p><p>D3 was created by Mike Bostock, along with other contributors. It is open source and uses a BSD license.</p><p>D3 uses HTML, CSS, JavaScript, the DOM, and SVG, so knowledge of those topics is helpful. To see examples of using D3, click the &quot;Examples&quot; link near the top of <a href="https://d3.js.org">https://d3.js.org</a>.</p><p>There are 3 levels of D3 usage, using higher-level libraries, copying and modifying examples, and coding from scratch.</p><p>An example of a library that uses D3 is C3 (<a href="https://c3js.org/">https://c3js.org/</a>). It uses D3 under the hood to render many kinds of charts. These charts are customizable, but not to the extent that coding from scratch provides. But charts can be implemented quickly this way and the requirement to have deep knowledge of D3 is removed. They respond well to changes in data, including transitions from old to new values.</p><p>There are many sites that provided examples of charts implemented with D3. Perhaps you can find an example that almost exactly what you want. Copying and customizing the code will often require far less time than implementing a chart from scratch.</p><p>My hope is that by the time you finish reading this article, you will know enough about D3 to enable a final option which is implementing an entire chart from scratch. This provides the most flexibility, but requires the most effort.</p><p>The D3 JavaScript API uses CSS selectors to find elements in the DOM that it modifies. It also provides methods to append elements and text nodes, set attributes, and modify text content. In this respect it has overlap with jQuery functionality.</p><p>The functionality of D3 is divided into modules. A default build includes a collection of commonly used modules. Custom builds can omit unneeded modules and add ones not in the default build in order to minimize the amount of code that must be downloaded to browsers.</p><p>These modules include:</p><ul><li>Arrays</li><li>Axes</li><li>Brushes</li><li>Chords</li><li>Collections (Objects, Maps, Sets, Nests)</li><li>Colors</li><li>Color Schemes</li><li>Contours</li><li>Dispatches</li><li>Dragging</li><li>Delimiter-Separated Values</li><li>Easings</li><li>Fetches</li><li>Forces</li><li>Number Formats</li><li>Geographies</li><li>Hierarchies</li><li>Interpolators</li><li>Paths</li><li>Polygons</li><li>Quadtrees</li><li>Random Numbers</li><li>Scales</li><li>Selections</li><li>Shapes</li><li>Time Formats</li><li>Time Intervals</li><li>Timers</li><li>Transitions</li><li>Voronoi Diagrams</li><li>Zooming</li></ul><p>Let's learn D3 by example. Many D3 tutorials start with a bar chart and so will we. But ours will include more features than typically shown in tutorials in order to introduce more D3 concepts.</p><h3>SVG Basics</h3><p>SVG stands for Scalable Vector Graphics. It is an XML-based syntax for specifying vector graphics and is supported by all modern web browsers.</p><p>SVG elements include <code>svg</code>, <code>line</code>, <code>polygon</code>, <code>rect</code>, <code>circle</code>, <code>path</code>, <code>text</code>, <code>image</code>, <code>g</code> (for group), and many more. For our bar chart will will only need <code>svg</code>, <code>g</code>, <code>rect</code>, and <code>text</code>.</p><p>Let's get started by drawing a rectangle and putting some text on it.</p><p><img src="/blog/assets/d3-svg-demo.png" alt="D3 SVG demo"></p><h3><code>svg-demo.html</code></h3><pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 SVG Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>D3 SVG Demo<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./svg-demo.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./svg-demo.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3><code>svg-demo.css</code></h3><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.bar > rect</span> <span class="token punctuation">{</span><br>  <span class="token property">stroke</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><br>  <span class="token property">stroke-width</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.bar > text</span> <span class="token punctuation">{</span><br>  <span class="token property">fill</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br>  <span class="token property">text-anchor</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span> <span class="token comment">/* horizontally centers */</span><br><span class="token punctuation">}</span><br><br><span class="token selector">#chart</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3><code>svg-demo.js</code></h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">HEIGHT</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">WIDTH</span> <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> score <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// out of 10</span><br><span class="token keyword">const</span> barHeight <span class="token operator">=</span> <span class="token constant">HEIGHT</span> <span class="token operator">*</span> <span class="token punctuation">(</span>score <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> barWidth <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> svg <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token constant">WIDTH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> group <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>group<br>  <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> barHeight<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> barWidth<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span> <span class="token operator">-</span> barHeight<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token string">'cornflowerblue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>group<br>  <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> barWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// center horizontally in bar</span><br>  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span> <span class="token operator">-</span> barHeight <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// just below top</span></code></pre><h3>Drawing Bars</h3><p>Now that we know how to draw on bar, let's draw one for each piece of data in an array. We will create a bar chart like the following:</p><p><img src="/blog/assets/bar-chart.png" alt="D3 Bar Chart"></p><p>The &quot;Update&quot; button generates new, random data and updates the bars. This is implemented by the files <code>index.html</code>, <code>bar-chart.css</code>, and <code>bar-chart.js</code> which are shown below.</p><p>This code gives us a good base for adding features. There are many D3 concepts to cover here. See comments in the code for details.</p><h3><code>index.html</code></h3><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 Bar Chart<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>D3 Bar Chart<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./bar-chart.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./bar-chart.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token comment">&lt;!-- The bars will be added in this svg element. --></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chart<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><br>      <span class="token comment">&lt;!-- Render a new version of the chart when this is pressed. --></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>updateData()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Update<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3><code>bar-chart.css</code></h3><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.bar > rect</span> <span class="token punctuation">{</span><br>  <span class="token property">stroke</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><br>  <span class="token property">stroke-width</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">button</span> <span class="token punctuation">{</span><br>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">#chart</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3><code>bar-chart.js</code></h3><pre class="language-js"><code class="language-js"><span class="token comment">// Later these will be adjusted to make room</span><br><span class="token comment">// for a vertical and horizontal axis.</span><br><span class="token keyword">const</span> <span class="token constant">BOTTOM_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">LEFT_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">RIGHT_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><br><span class="token comment">// Full size of the svg element.</span><br><span class="token keyword">const</span> <span class="token constant">HEIGHT</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">WIDTH</span> <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span><br><br><span class="token comment">// Size that can be used for the bars.</span><br><span class="token keyword">const</span> usableHeight <span class="token operator">=</span> <span class="token constant">HEIGHT</span> <span class="token operator">-</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">-</span> <span class="token constant">BOTTOM_PADDING</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> usableWidth <span class="token operator">=</span> <span class="token constant">WIDTH</span> <span class="token operator">-</span> <span class="token constant">LEFT_PADDING</span> <span class="token operator">-</span> <span class="token constant">RIGHT_PADDING</span><span class="token punctuation">;</span><br><br><span class="token comment">// Random data will be selected from this array.</span><br><span class="token keyword">const</span> allData <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'banana'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'cherry'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'date'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'grape'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'mango'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'peach'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'raspberry'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'strawberry'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'tangerine'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'watermelon'</span><span class="token punctuation">,</span> colorIndex<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> barPadding<span class="token punctuation">,</span> barWidth<span class="token punctuation">,</span> xScale<span class="token punctuation">,</span> yScale<span class="token punctuation">;</span><br><br><span class="token comment">// This is used to select bar colors based on their score.</span><br><span class="token keyword">const</span> colorScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleOrdinal</span><span class="token punctuation">(</span>d3<span class="token punctuation">.</span>schemePaired<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12 colors</span><br><br><span class="token comment">// This returns a random integer from 1 to max inclusive.</span><br><span class="token keyword">const</span> <span class="token function-variable function">random</span> <span class="token operator">=</span> <span class="token parameter">max</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// This returns an array of objects taken from allData.</span><br><span class="token comment">// A "score" property with a random value from 1 to 10</span><br><span class="token comment">// is added to each object.</span><br><span class="token keyword">function</span> <span class="token function">getRandomData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">random</span><span class="token punctuation">(</span>allData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> shuffled <span class="token operator">=</span> allData<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">0.5</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> shuffled<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  data<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f1<span class="token punctuation">,</span> f2</span><span class="token punctuation">)</span> <span class="token operator">=></span> f1<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    item<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> data<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This updates the attributes of an SVG rect element</span><br><span class="token comment">// that represents a bar.</span><br><span class="token keyword">function</span> <span class="token function">updateRect</span><span class="token punctuation">(</span><span class="token parameter">rect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  rect<br>    <span class="token comment">// Each fruit will keep the same color as its score changes.</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token function">colorScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>colorIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> barWidth <span class="token operator">-</span> barPadding <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> usableHeight <span class="token operator">-</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> barPadding<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This updates the bar chart with random data.</span><br><span class="token keyword">function</span> <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">getRandomData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Calculate padding on sides of bars based on # of bars.</span><br>  barPadding <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Calculate the width of each bar based on # of bars.</span><br>  barWidth <span class="token operator">=</span> usableWidth <span class="token operator">/</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a scale to map data index values to x coordinates.</span><br>  <span class="token comment">// This is a function that takes a value in the "domain"</span><br>  <span class="token comment">// and returns a value in the "range".</span><br>  xScale <span class="token operator">=</span> d3<br>    <span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">LEFT_PADDING</span><span class="token punctuation">,</span> <span class="token constant">LEFT_PADDING</span> <span class="token operator">+</span> usableWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a scale to map data score values to y coordinates.</span><br>  <span class="token comment">// The range is flipped to account for</span><br>  <span class="token comment">// the SVG origin being in the upper left corner.</span><br>  <span class="token comment">// Like xScale, this is a function that takes a value in the "domain"</span><br>  <span class="token comment">// and returns a value in the "range".</span><br>  <span class="token keyword">const</span> max <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  yScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> max<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>usableHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a D3 selection object that represents the svg element</span><br>  <span class="token comment">// and set the size of the svg element.</span><br>  <span class="token keyword">const</span> svg <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token constant">WIDTH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// This is the most critical part to understand!</span><br>  <span class="token comment">//</span><br>  <span class="token comment">// svg.selectAll('.bar') returns a new D3 selection.</span><br>  <span class="token comment">// A D3 selection contains three sub-selections</span><br>  <span class="token comment">// referred to as "update", "enter", and "exit".</span><br>  <span class="token comment">// "update" contains all the existing .bar elements for which data exists.</span><br>  <span class="token comment">// "enter" contains a placeholder for each .bar element</span><br>  <span class="token comment">// that needs to be created to accommodate a data value.</span><br>  <span class="token comment">// "exit" contains all the existing .bar elements</span><br>  <span class="token comment">// for which no data will be assigned.</span><br>  <span class="token comment">//</span><br>  <span class="token comment">// The first time this runs, there are no existing</span><br>  <span class="token comment">// DOM elements with a CSS class of "bar".</span><br>  <span class="token comment">// So update and exit will be empty, and enter will contain</span><br>  <span class="token comment">// a placeholder for each of the data values.</span><br>  <span class="token comment">//</span><br>  <span class="token comment">// Suppose that in the previous run there were 3 data values</span><br>  <span class="token comment">// and in this run there are 5 data values.</span><br>  <span class="token comment">// update will contain all three of the existing .bar elements,</span><br>  <span class="token comment">// enter will contain two placeholders, and exit will be empty.</span><br>  <span class="token comment">//</span><br>  <span class="token comment">// Suppose that in the previous run there were 5 data values</span><br>  <span class="token comment">// and in this run there are 3 data values.</span><br>  <span class="token comment">// update will contain three of the five existing .bar elements,</span><br>  <span class="token comment">// enter will be empty, and exit will contain two .bar elements</span><br>  <span class="token comment">// that can be removed.</span><br>  <span class="token comment">//</span><br>  <span class="token comment">// The data method ...</span><br>  <span class="token comment">//</span><br>  <span class="token comment">// The join method ...</span><br>  <span class="token keyword">const</span> groups <span class="token operator">=</span> svg<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><br>      <span class="token parameter">enter</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token comment">// Create a new SVG group element for each placeholder</span><br>        <span class="token comment">// to represent a new bar.</span><br>        <span class="token keyword">const</span> groups <span class="token operator">=</span> enter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Create a new SVG rect element for each group.</span><br>        groups<br>          <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> usableHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Create a new SVG text element for each group.</span><br>        groups<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> usableHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token keyword">return</span> groups<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token parameter">update</span> <span class="token operator">=></span> update<span class="token punctuation">,</span><br>      <span class="token parameter">exit</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token comment">// Shrink the height of the exiting rects gradually</span><br>        <span class="token comment">// and then remove them them.</span><br>        exit<br>          <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token constant">TOP_PADDING</span> <span class="token operator">+</span> usableHeight<span class="token punctuation">)</span><br>          <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> exit<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// The join method call above returns a selection that combines</span><br>  <span class="token comment">// the update and enter sub-selections into its update selection.</span><br>  <span class="token comment">// This allows operations needed on elements in both</span><br>  <span class="token comment">// to be performed on the new selection.</span><br><br>  <span class="token comment">// Translate the groups for each bar to their</span><br>  <span class="token comment">// appropriate x coordinate based on its index.</span><br>  <span class="token function">groups</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">group</span> <span class="token operator">=></span><br>    group<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">xScale</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 0)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Update all the rects using their newly associated data.</span><br>  groups<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>updateRect<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Render the first version of the chart.</span><br><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2>Adding Y Axis</h2><p>This covers <code>d3.max</code>, scales, and axis methods. This includes adding left and top padding to the chart.</p><h2>Adding X Axis</h2><p>This includes translating and rotating axis labels using the CSS <code>transform</code> property with the <code>translate</code> and <code>rotate</code> functions. This includes adding bottom and right padding to the chart.</p><h2>Adding Text on Bars</h2><p>This includes selecting a text color based on the bar color using relative luminance. See the <code>getTextColor</code> function. This includes horizontal centering with the CSS <code>text-anchor</code> property set to <code>middle</code>.</p><h2>Responding to Data Updates</h2><p>This includes generating random data. See the <code>random</code> and <code>getRandomData</code> functions.</p><h2>Adding Animation</h2><p>This includes using <code>transition</code>, <code>duration</code>, and <code>easing</code> methods. It also explains use of the <code>myTransition</code> function.</p>