<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Python functools module</h2><aside><nav class="toc"><ol><li><a href="#cache">cache</a></li><li><a href="#lru_cache">lru_cache</a></li><li><a href="#total_ordering">total_ordering</a></li><li><a href="#partial">partial</a></li><li><a href="#partial_method">partial_method</a></li><li><a href="#reduce">reduce</a></li><li><a href="#singledispatch">singledispatch</a></li><li><a href="#singledispatchmethod">singledispatchmethod</a></li><li><a href="#update_wrapper">update_wrapper</a></li><li><a href="#wraps">wraps</a></li></ol></nav></aside><article><p>The <code>functools</code> module in the Python standard library that provides&quot;higher-order&quot; functions which are functions that accept or return other functions. The most commonly used of these functions are demonstrated below.</p><p>In each of the code snippets that follow, the following import is needed:</p><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> <span class="token punctuation">{</span>function<span class="token operator">-</span>name<span class="token punctuation">}</span></code></pre><h2 id="cache"><code>cache</code></h2><p>This is a decorator that memoized a function, which causes it to cache return values so repeated calls with the same arguments return the cached value rather that execute the function again. For example:</p><pre class="language-python"><code class="language-python"><span class="token decorator annotation punctuation">@cache</span><br><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">:</span><br>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'computing </span><span class="token interpolation"><span class="token punctuation">{</span>n1<span class="token punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">{</span>n2<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<br><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="lru_cache"><code>lru_cache</code></h2><p>This is a decorator that is similar to <code>@cache</code>, but only caches results for the <code>maxsize</code> most recent argument lists. When the cache becomes full, the least recently used cached value is evicted. The <code>maxsize</code> argument defaults to 128. For example:</p><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> functools <span class="token keyword">import</span> lru_cache<br><br><span class="token decorator annotation punctuation">@lru_cache</span><span class="token punctuation">(</span>maxsize<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><br><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'computing </span><span class="token interpolation"><span class="token punctuation">{</span>n1<span class="token punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">{</span>n2<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<br><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># computes</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># uses cache</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># computes</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># uses cache</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># computes</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># uses cache</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># computes</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># uses cache</span><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># computes because previously cached value was evicted</span><br><br><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">.</span>cache_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment"># CacheInfo(hits=4, misses=5, maxsize=3, currsize=3)</span></code></pre><h2 id="total_ordering"><code>total_ordering</code></h2><p>This adds comparison methods to a class based on an existing <code>eq</code> method and at least one of the comparison methods <code>le</code>, <code>lt</code>, <code>gt</code>, or <code>ge</code>. For example:</p><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum<br><span class="token keyword">from</span> functools <span class="token keyword">import</span> total_ordering<br><span class="token keyword">import</span> math<br><br>M_TO_KM <span class="token operator">=</span> <span class="token number">1.60934</span><br><br><span class="token keyword">class</span> <span class="token class-name">DUnit</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    KM <span class="token operator">=</span> <span class="token number">1</span><br>    MILE <span class="token operator">=</span> <span class="token number">2</span><br><br><span class="token keyword">def</span> <span class="token function">km</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>mag <span class="token keyword">if</span> d<span class="token punctuation">.</span>unit <span class="token operator">==</span> DUnit<span class="token punctuation">.</span>KM <span class="token keyword">else</span> d<span class="token punctuation">.</span>mag <span class="token operator">*</span> M_TO_KM<br><br><span class="token decorator annotation punctuation">@total_ordering</span><br><span class="token keyword">class</span> <span class="token class-name">Distance</span><span class="token punctuation">:</span><br>    <span class="token comment"># unit must be a DUnit.</span><br>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mag<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        self<span class="token punctuation">.</span>mag <span class="token operator">=</span> mag<br>        self<span class="token punctuation">.</span>unit <span class="token operator">=</span> unit<br><br>    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">return</span> math<span class="token punctuation">.</span>isclose<span class="token punctuation">(</span>km<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">,</span> km<span class="token punctuation">(</span>other<span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">def</span> <span class="token function">__lt__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">return</span> km<span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">&lt;</span> km<span class="token punctuation">(</span>other<span class="token punctuation">)</span><br><br>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mag<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'km'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>unit <span class="token operator">==</span> DUnit<span class="token punctuation">.</span>KM <span class="token keyword">else</span> <span class="token string">' mile'</span><span class="token punctuation">)</span><br><br>k5 <span class="token operator">=</span> Distance<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> DUnit<span class="token punctuation">.</span>KM<span class="token punctuation">)</span><br>k10 <span class="token operator">=</span> Distance<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> DUnit<span class="token punctuation">.</span>KM<span class="token punctuation">)</span><br>m3 <span class="token operator">=</span> Distance<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> DUnit<span class="token punctuation">.</span>MILE<span class="token punctuation">)</span><br>m10 <span class="token operator">=</span> Distance<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> DUnit<span class="token punctuation">.</span>MILE<span class="token punctuation">)</span><br><br>races <span class="token operator">=</span> <span class="token punctuation">[</span>m10<span class="token punctuation">,</span> k5<span class="token punctuation">,</span> m3<span class="token punctuation">,</span> k10<span class="token punctuation">]</span><br>races<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token keyword">for</span> race <span class="token keyword">in</span> races<span class="token punctuation">:</span><br>    <span class="token keyword">print</span><span class="token punctuation">(</span>race<span class="token punctuation">)</span><br><br><span class="token keyword">assert</span> races<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> m3<br><span class="token keyword">assert</span> races<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> m10<br><span class="token keyword">assert</span> m3 <span class="token operator">&lt;</span> k5<br><span class="token keyword">assert</span> m3 <span class="token operator">&lt;=</span> k5<br><span class="token keyword">assert</span> k5 <span class="token operator">></span> m3<br><span class="token keyword">assert</span> k5 <span class="token operator">>=</span> m3<br><span class="token keyword">assert</span> m3 <span class="token operator">!=</span> k5</code></pre><h2 id="partial"><code>partial</code></h2><pre class="language-python"><code class="language-python"></code></pre><h2 id="partial_method"><code>partial_method</code></h2><pre class="language-python"><code class="language-python"></code></pre><h2 id="reduce"><code>reduce</code></h2><pre class="language-python"><code class="language-python"></code></pre><h2 id="singledispatch"><code>singledispatch</code></h2><pre class="language-python"><code class="language-python"></code></pre><h2 id="singledispatchmethod"><code>singledispatchmethod</code></h2><pre class="language-python"><code class="language-python"></code></pre><h2 id="update_wrapper"><code>update_wrapper</code></h2><pre class="language-python"><code class="language-python"></code></pre><h2 id="wraps"><code>wraps</code></h2><pre class="language-python"><code class="language-python"></code></pre></article>