<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Meteor</h2><h3>Overview</h3><p>Meteor (<a href="https://www.meteor.com/">https://www.meteor.com/</a>) is an open-source, full-stack, JavaScript platform for building web and mobile (Android and iOS) applications. It is referred to as a platform instead of a framework because it works with other frameworks. It is used to host client-side and server-side code.</p><p>Meteor is built on Node.js. It has good integration with the MongoDB NoSQL database. It supports a publish and subscribe mechanism to synchronize user interfaces with backend data, providing real-time updates.</p><p>A significant benefit of Meteor is the ability to implement significant functionality in a small amount of code. One example of this is user sign up and authentication.</p><p>Meteor has its own frontend framework called Blaze. But it also supports popular options such as Angular, React, Svelte, Vue, and Cordova.</p><p>Meteor was initially released in 2012. It gained immediate attention for its novel use of WebSockets as an alternative to HTTP. But the attention faded quickly as other frameworks garnered more notice. It is seeing some resurgence in 2020.</p><p>Galaxy is a cloud hosting platform for Meteor applications.</p><p>The use of WebSockets to support the Meteor pub/sub model has been replaced by the use of the Apollo framework and GraphQL. TODO: Has it been completely replaced?</p><p>Companies that use Meteor include Qualcomm, Mazda, IKEA, and Honeywell.</p><p>Enterprise support is available in order to have guaranteed support response times and SLAs.</p><p>Meteor provides many command-line tools. These are summarized at <a href="https://docs.meteor.com/commandline.html">https://docs.meteor.com/commandline.html</a>. Enter <code>meteor help</code> for help on using these.</p><h3>Installing Meteor</h3><p>See <a href="https://www.meteor.com/install">https://www.meteor.com/install</a>. In Linux or macOS, enter <code>curl https://install.meteor.com | sh</code>. In Windows, install Chocolatey and enter <code>choco install meteor</code>.</p><p>This installs several tools used by Meteor including MongoDB and TypeScript.</p><h2>Meteor Application Directory Structure</h2><p>The recommended directory structure for Meteor applications is described below.</p><ul><li><code>client</code><ul><li><code>main.html</code></li><li><code>main.css</code></li><li><code>main.js</code></li></ul></li><li><code>server</code><ul><li><code>main.js</code></li></ul></li><li><code>imports</code> (legacy)<ul><li><code>client</code><ul><li><code>\*.js</code></li></ul></li><li><code>server</code><ul><li><code>\*.js</code></li></ul></li></ul></li></ul><p>In the past Meteor eagerly loaded files outside the <code>imports</code> directory and lazily loaded files inside the <code>imports</code> directory. As of Meteor 1.7 it no longer makes this distinction and all code is lazily loaded. So there is no longer a need to have an <code>imports</code> directory. All client-side files can be placed in the <code>client</code> directory and all server-side files can be placed in the <code>server</code> directory.</p><h3>Blaze Web Framework</h3><p>TODO: Learn something about this</p><h3>Collections</h3><p>Meteor stores data in &quot;collections&quot; that can be accessed from both client-side and server-side code. When data is added to a collection or existing data is modified, client code that uses it updates automatically.</p><p>Typically collections are associated with a MongoDB collection, but it's also possible to use other databases such as PostgreSQL and RethinkDB.</p><p>The following code demonstrates creating a MongoDB collection named &quot;Todos&quot;, inserting a document into the collection, and finding it.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> Todos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Todos<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token string">'t1'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'buy milk'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> todo <span class="token operator">=</span> Todos<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token string">'t1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The same code can be used in server-side or client-side code. When run server-side, it actually creates a collection and populates it. When run client-side, it creates a client-side cache using the &quot;Minimonogo&quot; library which provides an in-memory JavaScript implementation of the MongoDB API.</p><p>Client code must subscribe to a publication in order to receive updates from the server. This keeps the client-side cache in sync with a subset of the data on the server. It uses the Meteor Distributed Data Protocol (DDP) to send data in both directions.</p><p>Client code can update a collection on the server using a &quot;method&quot; which uses Meteor remote procedure call (RPC).</p><h3>ESLint</h3><p>ESLint will give &quot;Unable to resolve path to module&quot; errors on all imports that begin with &quot;meteor/&quot;. However, the Meteor build system is able to resolve these. To suppress these errors, add the following to your <code>.eslintrc.json</code> file:</p><pre class="language-json"><code class="language-json">  <span class="token property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"import/no-unresolved"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token property">"ignore"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"^meteor/"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><br>  <span class="token punctuation">}</span></code></pre><h3>Tutorials</h3><p>The Meteor web site contains several tutorials that provide an introduction to using Meteor. See <a href="https://www.meteor.com/tutorials">https://www.meteor.com/tutorials</a>.</p><p>Let's walk through the steps to build a Todo app using Meteor.</p><p>Create the app starting point by entering <code>meteor create todos</code>. To use a non-default app templates, add one of the following options after <code>create</code>: <code>--bare</code>, <code>--minimal</code>, <code>--full</code>, <code>--react</code>, or <code>--typescript</code> Interestingly none of these options corresponds to the default. The default option produces applications that are insecure and are therefore only for prototyping. They allow all MongoDB updates to be initiated from clients. For details on the features included by default and with each option see <a href="https://docs.meteor.com/commandline.html#meteorcreate">https://docs.meteor.com/commandline.html#meteorcreate</a>.</p><p>Enter <code>cd todos</code>.</p><p>Run the app by entering <code>meteor</code>.</p><p>Browse localhost:3000. The following page will be rendered.</p><p><img src="/blog/assets/meteor-default-page.png" alt="cover"></p><p>The UI is defined by the following files in the <code>client</code> directory: <code>main.html</code>, <code>main.css</code>, and <code>main.js</code>.</p><p>Try editing the file <code>client/main.html</code>. The browser will updated automatically. Meteor refers to this as &quot;hot code push&quot;.</p><p>Now let's configure the app to use Svelte as its web framework, instead of the default Blaze framework. Svelte is a good choice due to its use of reactive statements.</p><p>It is recommended to use the command <code>meteor npm</code> instead of <code>npm</code> when installing npm packages in a Meteor app. When packages have binary dependencies, this ensures that they are built using the same C libraries.</p><ol><li><p>Enter <code>meteor npm install svelte</code></p></li><li><p>Add some Meteor packages by entering <code>meteor add svelte:compiler rdb:svelte-meteor-data</code></p></li><li><p>Remove a package that will not be used by entering <code>meteor remove blaze-html-templates</code></p></li><li><p>Add a replacement Meteor package by entering <code>meteor add static-html</code></p></li><li><p>Replace the content of <code>client/main.html</code> with the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre></li><li><p>Replace the content of <code>client/main.js</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'../imports/ui/App.svelte'</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'meteor.md x: Meteor ='</span><span class="token punctuation">,</span> Meteor<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>target<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create a top-level project directory named <code>imports</code>.</p></li><li><p>Create a directory inside <code>imports</code> named <code>ui</code>.</p></li><li><p>Create the file <code>imports/ui/Task.svelte</code> containing the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> task<span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">formatDate</span> <span class="token operator">=</span> <span class="token parameter">date</span> <span class="token operator">=></span><br>    date<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'en-us'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      month<span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span><br>      day<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br>      year<span class="token operator">:</span> <span class="token string">'numeric'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>{task.text} - added {formatDate(task.createdAt)}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></code></pre></li><li><p>Create the file <code>imports/ui/App.svelte</code> containing the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> Task <span class="token keyword">from</span> <span class="token string">'./Task.svelte'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">getTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'This is task 1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'This is task 2'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'This is task 3'</span><span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>    {#each getTasks() as task}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">task</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{task}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    {/each}<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></li><li><p>Copy the CSS from <a href="https://github.com/meteor/simple-todos-svelte/blob/master/client/main.css">here</a> into <code>client/main.css</code>.</p></li><li><p>Create <code>imports/tasks.js</code> containing the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Mongo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/mongo'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following near the top of <code>server/main.js</code> to create the MongoDB collection:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following imports near the top of <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>useTracker<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/rdb:svelte-meteor-data'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span> <span class="token comment">// creates local collection cache</span></code></pre></li><li><p>Replace the <code>getTasks</code> function in <code>client/App.svelte</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span>sort<span class="token operator">:</span> <span class="token punctuation">{</span>createdAt<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// newest first</span><br>$<span class="token operator">:</span> tasks <span class="token operator">=</span> <span class="token function">useTracker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the call to <code>getTasks()</code> in <code>client/App.svelte</code> with <code>$tasks</code>.</p></li><li><p>Insert some tasks using the MongoDB console by entering the following:</p><pre class="language-bash"><code class="language-bash">meteor mongo<br>db.tasks.insert<span class="token punctuation">(</span><span class="token punctuation">{</span> text: <span class="token string">"buy milk"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Note that the UI updates automatically to show this todo item.</p></li><li><p>Add the following in <code>client/App.svelte</code> after the <code>header</code> element:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">on:</span>submit|preventDefault</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{addTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todo text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{text}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></li><li><p>Add the following inside the <code>script</code> tag in <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token punctuation">,</span> createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following after the HTML in <code>client/App.svelte</code>:</p><pre class="language-css"><code class="language-css"><span class="token selector">&lt;style><br>  form</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>&lt;/style></code></pre><p>Now new tasks can be added by entering text in the input and either pressing the &quot;Add&quot; button or pressing the return key. Meteor keeps all clients in sync. To see this, open a second web browser or another window in the same web browser and browse localhost:3000. Add a todo in either browser window and notice that it appears in both.</p></li><li><p>Add the ability to mark tasks as done and delete them by changing <code>client/Task.svelte</code> to match the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> task<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">formatDate</span> <span class="token operator">=</span> <span class="token parameter">date</span> <span class="token operator">=></span><br>    date<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'en-us'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      month<span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span><br>      day<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br>      year<span class="token operator">:</span> <span class="token string">'numeric'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">toggleDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>done<span class="token operator">:</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>done<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{task.done}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{toggleDone}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">class:</span>done</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{task.done}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    {task.text} - added {formatDate(task.createdAt)}<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- Using Unicode trash can --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{deleteTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token entity" title="&#x1f5d1;">&amp;#x1f5d1;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">button</span> <span class="token punctuation">{</span><br>    <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span><br>    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">.done</span> <span class="token punctuation">{</span><br>    <span class="token property">opacity</span><span class="token punctuation">:</span> 0.3<span class="token punctuation">;</span><br>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> line-through<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre></li><li><p>Show the number of remaining tasks and total tasks in the heading by making the following changes in <code>client/App.svelte</code>:</p><ul><li><p>Add the following in the <code>script</code> tag:</p><pre class="language-js"><code class="language-js">$<span class="token operator">:</span> remaining <span class="token operator">=</span> $tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token operator">!</span>t<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></code></pre></li><li><p>Add the following after the <code>header</code> tag:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{remaining} of {$tasks.length} remaining<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></li></ul></li><li><p>Add the ability to only display tasks that are not done by making the following changes in <code>client/App.svelte</code>:</p><ul><li><p>Add the following variable declaration in the <code>script</code> tag:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> hideCompleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following in side the <code>form</code> element:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hide-completed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{hideCompleted}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  Hide Completed Tasks<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></code></pre></li><li><p>Change the content of the <code>{#each}</code> block to the following:</p><pre class="language-html"><code class="language-html">{#if !hideCompleted || !task.done}<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>{/if}</code></pre></li></ul></li><li><p>Add support for user accounts by doing the following:</p><ul><li><p>Enter <code>meteor add accounts-ui accounts-password</code></p></li><li><p>Enter <code>meteor add svelte:blaze-integration</code></p></li><li><p>Create the file <code>imports/account-config.js</code> with the following content:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Accounts<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/accounts-base'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Email is needed for the next step.</span><br>Accounts<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  passwordSignupFields<span class="token operator">:</span> <span class="token string">'USERNAME_AND_EMAIL'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following near the top of <code>client/main.js</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'../imports/accounts-config.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Modify the <code>client/App.svelte</code> file to match the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>useTracker<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/rdb:svelte-meteor-data'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>BlazeTemplate<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/svelte:blaze-integration'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> Task <span class="token keyword">from</span> <span class="token string">'./Task.svelte'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> hideCompleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> user<span class="token punctuation">;</span><br><br>  <span class="token comment">// user is a store</span><br>  $<span class="token operator">:</span> user <span class="token operator">=</span> <span class="token function">useTracker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Meteor<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span>sort<span class="token operator">:</span> <span class="token punctuation">{</span>createdAt<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token comment">// tasks is a store</span><br>  $<span class="token operator">:</span> tasks <span class="token operator">=</span> <span class="token function">useTracker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  $<span class="token operator">:</span> remaining <span class="token operator">=</span> $tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token operator">!</span>t<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      text<span class="token punctuation">,</span><br>      createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      owner<span class="token operator">:</span> Meteor<span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      username<span class="token operator">:</span> $user<span class="token punctuation">.</span>username<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BlazeTemplate</span> <span class="token attr-name">template</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginButtons<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><br><br>  {#if $user}<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{remaining} of {$tasks.length} remaining<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">on:</span>submit|preventDefault</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{addTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todo text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{text}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hide-completed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{hideCompleted}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      Hide Completed Tasks<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>    {#each $tasks as task} {#if !hideCompleted || !task.done}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>    {/if} {/each}<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>  {/if}<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">form</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-buttons)</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span><br>    <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-buttons a)</span> <span class="token punctuation">{</span><br>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-dropdown-list)</span> <span class="token punctuation">{</span><br>    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span><br>    <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>We now have the ability to create accounts, sign in, change the password of the signed in user, and sign out.</p></li></ul></li><li><p>Add support for &quot;forgot password&quot; emails. This will allow users to click a &quot;Forgot password&quot; link in the &quot;Sign in&quot; dialog which changes the dialog content to prompt for an email address. If a user account exists for the email address, it is sent an email containing a link that the user can click to reset their password. After doing so they are immediately signed in.</p><ul><li><p>Enter <code>meteor add email</code>.</p></li><li><p>Create the file <code>secrets.json</code> in the project root directory with content like the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"MAIL_NAME"</span><span class="token operator">:</span> <span class="token string">"Your Name"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_USER"</span><span class="token operator">:</span> <span class="token string">"some-user"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_PASSWORD"</span><span class="token operator">:</span> <span class="token string">"some-password"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_USER_DOMAIN"</span><span class="token operator">:</span> <span class="token string">"some-company.com"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_SERVER_DOMAIN"</span><span class="token operator">:</span> <span class="token string">"smtp.gmail.com"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_SERVER_PORT"</span><span class="token operator">:</span> <span class="token number">587</span><br><span class="token punctuation">}</span></code></pre><p>Note that the last two values above are specific to using a Google G Suite account for sending email.</p></li><li><p>If using Git, add <code>secrets.json</code> to the <code>.gitignore</code> file so it is not added to the repository for others to see.</p></li><li><p>Create the file <code>server/accounts-setup.js</code> with the following content:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Accounts<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/accounts-base'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> secrets <span class="token keyword">from</span> <span class="token string">'../secrets.json'</span><span class="token punctuation">;</span><br><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>siteName <span class="token operator">=</span> <span class="token string">'Todos by Mark V.'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token keyword">from</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER_DOMAIN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>from <span class="token operator">=</span> <span class="token keyword">from</span><span class="token punctuation">;</span></code></pre></li><li><p>Modify the file <code>server/main.js</code> to match the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'./accounts-setup.js'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> secrets <span class="token keyword">from</span> <span class="token string">'../secrets.json'</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// code to run on server at startup</span><br>  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MAIL_URL</span> <span class="token operator">=</span><br>    <span class="token string">'smtp://'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER</span> <span class="token operator">+</span><br>    <span class="token string">'%40'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER_DOMAIN</span> <span class="token operator">+</span><br>    <span class="token string">':'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_PASSWORD</span> <span class="token operator">+</span><br>    <span class="token string">'@'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_SERVER_DOMAIN</span> <span class="token operator">+</span><br>    <span class="token string">':'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_SERVER_PORT</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul></li><li><p>Make the app more secure by moving database interactions to the server. This is accomplished by implemented &quot;methods&quot; that are invoked by client-side code. Client code invokes them using <code>Meteor.call(name, data, callback)</code> which makes a Remote Procedure Call (RPC) using WebSockets, not by sending an HTTP request. The callback function is passed an error description and a result. If the call succeeds, the error description is undefined and the result is set to whatever value the method returns. If the call fails, the error description is set to an object that contains the properties <code>error</code> (HTTP status code), <code>reason</code> (concise message), <code>message</code> (long message), and more. It does not throw a JavaScript Error, so try/catch cannot be used. An issue with using Meteor Methods instead of REST services is that they really can only be called from Meteor apps. Methods that throw should do so using <code>throw new Meteor.error(methodName, message)</code>. Throwing a normal JavaScript Error will not return the message to the client.</p><ul><li><p>Enter <code>meteor remove insecure</code></p></li><li><p>Define server-side methods by modifying <code>server/tasks.js</code> to match the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>check<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/check'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Mongo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/mongo'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br><br>    <span class="token comment">// Make sure the user is logged in before inserting a task.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Meteor<span class="token punctuation">.</span>Error</span><span class="token punctuation">(</span><span class="token string">'add-task'</span><span class="token punctuation">,</span> <span class="token string">'not-authorized'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> <span class="token punctuation">{</span>username<span class="token punctuation">}</span> <span class="token operator">=</span> Meteor<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      text<span class="token punctuation">,</span><br>      createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      owner<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">,</span><br>      username<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> id<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token function">setDone</span><span class="token punctuation">(</span><span class="token parameter">taskId<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> <span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>done<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create the file <code>client/util.js</code> containing the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Replace this will better error handling.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following <code>imports</code> in <code>client/App.svelte</code> and <code>client/Task.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>handleError<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./util'</span><span class="token punctuation">;</span></code></pre></li><li><p>Change the call to <code>Tasks.insert</code> in the <code>addTask</code> function of <code>client/App.svelte</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'addTask'</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Change the call to <code>Tasks.remove</code> in the <code>deleteTask</code> function of <code>client/Task.svelte</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'deleteTask'</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Change the call to <code>Tasks.update</code> in the <code>toggleDone</code> function of <code>client/Task.svelte</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'setDone'</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>done<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Remove the import of <code>Tasks</code> from <code>client/Task.svelte</code> since it is no longer used.</p></li></ul></li></ol>