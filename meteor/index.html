<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Meteor</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#key-benefits">Key Benefits</a></li><li><a href="#installing">Installing</a></li><li><a href="#directory-structure">Directory Structure</a></li><li><a href="#collections">Collections</a></li><li><a href="#mongodb">MongoDB</a></li><li><a href="#methods">Methods</a></li><li><a href="#method-retries">Method Retries</a></li><li><a href="#viewing-websocket-messages">Viewing WebSocket Messages</a></li><li><a href="#meteor-websocket-messages">Meteor WebSocket Messages</a></li><li><a href="#optimistic-ui">Optimistic UI</a></li><li><a href="#tracker">Tracker</a></li><li><a href="#meteor-packages">Meteor Packages</a></li><li><a href="#eslint">ESLint</a></li><li><a href="#prettier">Prettier</a></li><li><a href="#tutorials">Tutorials</a></li><li><a href="#todo-app">Todo App</a></li><li><a href="#building-and-deploying">Building and Deploying</a><ol><li><a href="#galaxy">Galaxy</a></li></ol></li><li><a href="#resources">Resources</a></li></ol></nav></aside><article><h3 id="overview">Overview</h3><p>Meteor (<a href="https://meteor.com/" rel="noopener" target="_blank">meteor.com</a>) is an open-source, full-stack, JavaScript platform for building web and mobile (Android and iOS) applications. It is referred to as a platform instead of a framework because it works with other frameworks. It is used to host both client-side and server-side code.</p><p>Meteor is built on Node.js. It has good integration with the MongoDB NoSQL database. It supports a publish and subscribe mechanism to synchronize user interfaces (UIs) with backend data, providing real-time updates.</p><p>Meteor uses its own build systems and JavaScript bundler. It does not use Webpack, Rollup, or Parcel.</p><p>Meteor has its own frontend framework called Blaze. But it also supports other popular options that can be used in its place such as Angular, React, Svelte, Vue, and Cordova (for Android and iOS apps).</p><p>Meteor was initially released in 2012. It gained immediate attention for its novel use of WebSockets as an alternative to HTTP to achieve real-time updates. But the attention faded quickly as other frameworks garnered more notice. It is seeing some resurgence in 2020.</p><p>Tiny (<a href="https://www.tinycapital.com/" rel="noopener" target="_blank">tinycapital.com</a>) a Canadian technology holding company, acquired Meteor from the Meteor Development Group in October, 2019. This occurred after most of the Meteor Development Group team transitioned to working on Apollo GraphQL. The new Meteor company supports both Meteor and Galaxy. Galaxy is a commercial cloud hosting platform for Meteor applications.</p><p>Companies that use Meteor include Qualcomm, Mazda, IKEA, and Honeywell.</p><p>Enterprise support is available in order to have guaranteed support response times and service-level agreements (SLAs).</p><p>Meteor provides many command-line tools. These are summarized <a href="https://docs.meteor.com/commandline.html" rel="noopener" target="_blank">here</a>. Enter <code>meteor help</code> for help on using these.</p><h3 id="key-benefits">Key Benefits</h3><p>The key benefits of using Meteor are:</p><ul><li>One install provides client, server (Node.js), and database (MongoDB) setup.</li><li>Client and server code can be developed in a single language, JavaScript or TypeScript.</li><li>The UI can be implemented using any popular web framework.</li><li>User account management and authentication is provided. It even supports OAuth logins.</li><li>Changes to data in MongoDB collections are published to all connected clients using WebSockets so all the UIs can stay in sync.</li><li>There is no need to implement REST services or GraphQL queries if using Meteor Methods with WebSockets is acceptable. Meteor Methods are implemented in JavaScript or TypeScript and are described in detail later.</li></ul><p>All of this enables implementing significant functionality in a small amount of code.</p><h3 id="installing">Installing</h3><p>For platform-specific instructions on installing Meteor, see <a href="https://www.meteor.com/install" rel="noopener" target="_blank">here</a>. On Linux or macOS, enter <code>curl https://install.meteor.com | sh</code>. On Windows, install Chocolatey and enter <code>choco install meteor</code>.</p><p>This installs several tools used by Meteor including MongoDB and TypeScript.</p><h3 id="directory-structure">Directory Structure</h3><p>The recommended directory structure for Meteor applications is described below.</p><ul><li><code>client</code><ul><li><code>main.html</code></li><li><code>main.css</code></li><li><code>main.js</code></li></ul></li><li><code>server</code><ul><li><code>main.js</code></li></ul></li><li><code>imports</code><ul><li><code>\*.js</code></li></ul></li></ul><p>All client-side files can be placed in the <code>client</code> directory and all server-side files can be placed in the <code>server</code> directory.</p><p>In the past Meteor eagerly loaded files outside the <code>imports</code> directory and lazily loaded files inside the <code>imports</code> directory. As of Meteor 1.7 it no longer makes this distinction and all code is lazily loaded. So there is no longer a requirement to have an <code>imports</code> directory. However, it is still a useful location for files that are shared between client and server code.</p><h3 id="collections">Collections</h3><p>The client-side of Meteor applications can obtain data in many ways including REST calls and GraphQL queries that connect to any kind of database. The data can be stored in clients in many ways including JavaScript variables, session storage, and local storage.</p><p>The most common way for a Meteor application to store data is in &quot;collections&quot;. These are associated with a MongoDB collection. They can be accessed from both client and server code. When data is added to a collection, updated, or deleted, client code that uses it typically updates automatically. This is a significant benefit over using REST services that require the use of polling to get data updates.</p><p>The following code demonstrates creating a MongoDB collection named &quot;Todos&quot;, inserting a document into the collection, and finding it. MongoDB prefers for the unique id of each document to be held in property named <code>_id</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> Todos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Todos<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token string">'t1'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'buy milk'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> todo <span class="token operator">=</span> Todos<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token string">'t1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The same code can be used in client or server code when the Meteor &quot;insecure&quot; package is installed. (Later we will look at securing Meteor applications.) When run server-side, this code creates a MongoDB collection and populates it. When run client-side, it creates a client-side cache using the &quot;Minimonogo&quot; library which provides an in-memory JavaScript implementation of the MongoDB API.</p><p>Client code must subscribe to a publication in order to receive updates from the server. This keeps the client-side cache (implemented by Minimongo) in sync with a subset of the data in MongoDB on the server. This is accomplished by using the Meteor Distributed Data Protocol (DDP) to send WebSocket messages in both directions.</p><h3 id="mongodb">MongoDB</h3><p>MongoDB is a popular, powerful NoSQL database. There are many commands and options to master, but the following presents some of the basics for using the MongoDB console in conjunction with Meteor.</p><p>To start the MongoDB console, enter <code>meteor mongo</code>.</p><p>To see a list of all the databases, enter <code>show dbs</code>.</p><p>To use the Meteor database, enter <code>use meteor</code>.</p><p>To see a list of collections in the current database, enter <code>show collections</code>.</p><p>To see the first 20 documents in a given collection, enter <code>db.{coll-name}.find()</code>.</p><p>To delete all the documents in a collection, enter <code>db.{coll-name}.drop()</code>.</p><h3 id="methods">Methods</h3><p>Meteor Methods are functions that can reside only on the server or on both the client and server. They are meant to be called from client code. The server instance is invoked using a Remote Procedure Call (RPC) that utilizes WebSockets. By convention, &quot;Method&quot; is written with a capital &quot;M&quot; to distinguish it from normal JavaScript methods.</p><p>Meteor Methods are an alternative to REST calls implemented using HTTP. An issue with using Meteor Methods instead of REST is that they can only be called from the same Meteor app.</p><p>Common uses for Methods include inserting a document in a collection, deleting a document from a collection, and updating a document in a collection. There is typically no need to return anything to the client because changes in the MongoDB database are communicated back to the client through WebSocket messages that keep Minimongo in the client synchronized. Retrieving documents from collections is typically done by subscribing to them.</p><p>Methods can also be used to perform CRUD operations on SQL databases. It this case it makes sense for the methods on only reside on the server and for them to return data needed by the client.</p><p>To implement a Method, import <code>Meteor</code> from the <code>meteor/meteor</code> package and pass an object literal to <code>Meteor.methods</code>. The properties of the object are Method definitions. This registers the Methods with Meteor's DDP system. The <code>Meteor.methods</code> function can be called any number of times to register additional Methods.</p><p>The Methods can accept any number of parameters with any JavaScript types.</p><p>The <code>check</code> function in the <code>meteor/check</code> package can be used to check the types of parameters at runtime. Note that TypeScript types are only checked at compile-time. The <code>check</code> function throws a <code>Match.Error</code> if unexpected types are passed. For details on the <code>check</code> function, see <a href="https://docs.meteor.com/api/check.html" rel="noopener" target="_blank">here</a>.</p><p>To report other kinds of parameter validation errors, use <code>throw new ValidationError(message)</code>.</p><p>To report most other errors, use <code>throw new Meteor.Error(errorId, message[, details])</code>. The error id is typically the Method name followed by a period and an error name. If a generic JavaScript error is thrown instead using <code>throw new Error(message)</code>, the details will only appear on the server and clients will only be notified that an internal server error occurred.</p><p>To call a Method from client code, import <code>Meteor</code> from the <code>meteor/meteor</code> package and call <code>Meteor.call</code> passing it the name of a Method, any number of arguments, and a callback function. This triggers the Method call lifecycle which has six parts.</p><ol><li>If the Method is defined on the client, it is executed there. This typically updates Minimongo and corresponding UI updates are made.</li><li>A JSON-based DDP message is constructed and sent to the server using a WebSocket connection. This includes a message name (<code>msg</code> property set to &quot;method&quot;), Method name (in the <code>method</code> property), arguments (in the <code>params</code> property), and a generated Method id (in the <code>id</code> property).</li><li>The Method executes on the server, possibly updating MongoDB.</li><li>A return value is sent to the client in a message that includes a message name (<code>msg</code> property set to &quot;result&quot;), the previously generated Method id (in the <code>id</code> property), and the result (in the <code>result</code> property).</li><li>Any affected data in Minimongo is updated, but the UI is not yet updated.</li><li>The callback function passed to <code>Meteor.call</code> is passed an error description (if there was an error) and the result value. Now the UI is updated using data from Minimongo.</li></ol><p>If the call succeeds, the error description is <code>undefined</code> and the result is set to whatever value the Method returns. If the call fails, the error description is set to an object that contains the properties <code>error</code> (an HTTP status code even though HTTP isn't used), <code>reason</code> (concise message), <code>message</code> (long message), and more. It does not throw a JavaScript <code>Error</code>, so try/catch cannot be used.</p><p>Methods that throw should do so using <code>throw new Meteor.error(methodName, message)</code>. Throwing a normal JavaScript <code>Error</code> will not return a detailed error message to the client.</p><p>Let's implement a simple Method that just adds two numbers. It is not a typical Method because it does not update a collection. We will see several examples of Methods that update a collection later. To verify that the Method is called on both the client and server side, a <code>console.log</code> call is added. It will be output in the DevTools console AND in the terminal window where the server is running.</p><p>Create the directory <code>imports</code> and the file <code>imports/methods.js</code> containing the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>check<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/check'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum called; on server?'</span><span class="token punctuation">,</span> Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> Number<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> Number<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Add the following near the top of <code>server/main.js</code> to invoke the code above:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'../imports/methods.js'</span><span class="token punctuation">;</span></code></pre><p>To call the <code>sum</code> Method from client code, add the following in any client JavaScript file such as <code>client/main.js</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> number1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> number2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><br><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'sum'</span><span class="token punctuation">,</span> number1<span class="token punctuation">,</span> number2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum ='</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>If you prefer to use promises, implement a utility function that wraps calls in a <code>Promise</code> as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>An advantage of calling Methods in this way is that the result of one call can be used to form the arguments of another call without resorting to nested callback functions.</p><p>Using this new <code>call</code> function, our <code>sum</code> Method can be called from an <code>async</code> function as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App.svelte addTask: sum ='</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>A Method can return a <code>Promise</code>. Meteor will wait for the <code>Promise</code> to resolve or reject before returning a result or an error to the client.</p><h3 id="method-retries">Method Retries</h3><p>If a client calls a Method and their internet connection is lost before a result is returned, Meteor will remember this and will make the call again when connectivity is restored. This presents an issue when Methods are not idempotent. Being idempotent means that the when a call is repeated, no additional changes are made in the database.</p><p>Consider typical CRUD operations.</p><ul><li><p>Creating a new document in a collection using the same data multiple times is typically problematic and it's up to you to guard against this. For example, in a Todo app we could reject attempts to add multiple tasks with the same text.</p></li><li><p>Retrieving a document from a collection multiple times is not a problem.</p></li><li><p>Updating a document multiple times is not a problem as long as the document hasn't been modified using different data in the interim. This can be addressed by adding the last update timestamp to each document and verifying that it matches what is in the data for an update. When the timestamp does not match, we can assume the document has been updated since we last retrieved it and reject the update.</p></li><li><p>Deleting a document multiple times is not a problem as long as attempts to delete a non-existent document are not treated as errors.</p></li></ul><h3 id="viewing-websocket-messages">Viewing WebSocket Messages</h3><p>Chrome DevTools can be used to view the WebSocket messages that are sent by Meteor. Like HTTP messages, they appear on the Network tab. But unlike HTTP messages where there is a separate entry for each request/response pair, there is only a single WebSocket entry per connection. Selecting a connection displays all the messages sent over that connection.</p><p>To view WebSocket messages:</p><ol><li>Open the Chrome DevTools.</li><li>Select the &quot;Network&quot; tab.</li><li>Click &quot;WS&quot; to filter on WebSockets.</li><li>Refresh the browser to get a new WebSocket connection.</li><li>Click the WebSocket connection that is displayed.</li><li>Click the &quot;Messages&quot; tab to see all the WebSocket messages. This list is updated as new ones are received.</li><li>Click a message to see its details.</li></ol><p>Each message is an array of JSON objects that have a <code>msg</code> property and other properties such as <code>collection</code>, <code>fields</code>, <code>id</code>, <code>method</code>, <code>methods</code>, <code>msg</code>, and <code>params</code>. Typically each message array contains a single object.</p><p>Each message is preceded by an arrow. Outgoing messages have a green arrow pointing up and are sent from the client to the server. Incoming messages have a red arrow pointing down and are sent from the server to the client.</p><p>Periodically, about every 45 seconds, each side sends a &quot;ping&quot; message to verify that the other side is still reachable. The other side replies with a &quot;pong&quot; message.</p><h3 id="meteor-websocket-messages">Meteor WebSocket Messages</h3><p>When a client initially connects to the server, a series of messages are sent from the server to the client. While I can't describe the purpose of each of these messages, I can describe the pattern observed. These messages include:</p><ul><li><p>one matching</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"connect"</span><span class="token punctuation">,</span><br>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"{some-version}"</span><span class="token punctuation">,</span><br>  <span class="token property">"support"</span><span class="token operator">:</span> <span class="token punctuation">[</span>?<span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li><li><p>several matching</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"sub"</span><span class="token punctuation">,</span><br>  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"{some-id}"</span><span class="token punctuation">,</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"{some-name}"</span><span class="token punctuation">,</span><br>  <span class="token property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span>?<span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li><li><p>one matching <code>{&quot;server_id&quot;: &quot;{some-id}&quot;}</code></p></li><li><p>one matching <code>{&quot;msg&quot;: &quot;connected&quot;, &quot;session&quot;: &quot;{session-id}&quot;}</code></p></li><li><p>several matching <code>{&quot;msg&quot;: &quot;ready&quot;, &quot;subs&quot;: [?]}</code></p></li><li><p>several matching</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"added"</span><span class="token punctuation">,</span><br>  <span class="token property">"collection"</span><span class="token operator">:</span> <span class="token string">"meteor_autoupdate_clientversions"</span><span class="token punctuation">,</span><br>  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"version"</span><span class="token punctuation">,</span><br>  <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"version"</span><span class="token operator">:</span> "outdated<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li></ul><p>If the Meteor accounts packages are used to support account creation and sign in, a sign in request triggers a message from the client to the server containing the following JSON:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"method"</span><span class="token punctuation">,</span><br>  <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"login"</span><span class="token punctuation">,</span><br>  <span class="token property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"{username}"</span><span class="token punctuation">,</span><br>      <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"{hashed-password}"</span><span class="token punctuation">,</span><br>      <span class="token property">"algorithm"</span><span class="token operator">:</span> <span class="token string">"sha-256"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>A successful sign in triggers a message from the server to the client containing the following JSON:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"result"</span><span class="token punctuation">,</span><br>  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"{message-id}"</span><span class="token punctuation">,</span><br>  <span class="token property">"result"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"{result-id}"</span><span class="token punctuation">,</span><br>    <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"{token}"</span><span class="token punctuation">,</span><br>    <span class="token property">"token-expires"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"$date"</span><span class="token operator">:</span> <span class="token string">"{timestamp}"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"password"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Updates to the MongoDB database trigger additional JSON messages from the server to the client that describe the changes. This allows Minimongo in the client to stay in sync. Each message has a <code>msg</code> property that specifies the type of update, a <code>collection</code> property set to the name of the collection, and an <code>id</code> property set to the <code>_id</code> value of the affected document.</p><p>When a document is added to a collection, <code>msg</code> is set to &quot;added&quot; and <code>fields</code> set to a JSON object containing all the properties of the document.</p><p>When a document is updated, <code>msg</code> is set to &quot;changed&quot; and <code>fields</code> set to a JSON object containing only the properties of the document that were modified.</p><p>When a document is deleted from a collection, <code>msg</code> is set to &quot;remove&quot;.</p><p>If a client subscribes to a collection, &quot;added&quot; messages described above are sent from the server to initially populate Minimongo.</p><h3 id="optimistic-ui">Optimistic UI</h3><p>Optimistic UI is a feature of Meteor Methods, and also of Apollo GraphQL, that enables a UI to respond to user interactions without waiting for server responses. This is satisfied by the following properties.</p><ol><li><p>The UI is rendered on the client rather than waiting for the server to return HTML or data. This requires predicting the result of Method calls based on data that has been cached on the client.</p></li><li><p>The client-side cache (implemented by Minimongo) is a global cache rather than being associated with specific components, so it is not possible for components to disagree on the state. All affected components can re-render using the same data. When a MongoDB query is executed using a Meteor Method, it is first run against Minimongo on the client and then against MongoDB on the server.</p></li><li><p>The client subscribes to data using DDP to keep Minimongo on the client in sync with MongoDB on the server. Updates are made in real time, not using polling.</p></li><li><p>When the server returns the actual result of a Method call, Meteor verifies that it matches what the client predicted. If they differ, Meteor rolls back all the changes made from that point forward and replays them with the correct results from the server. UI changes triggered by Method calls are tracked in order to support the ability to rollback changes.</p></li></ol><p>All of this functionality is provided by default. The only requirement is for the client to use Meteor Methods to request data changes.</p><p>The following sequence diagram illustrates the order of these operations:</p><p><img src="/blog/assets/meteor-method-flow.png" alt="Meteor Method flow"></p><p>To see rollback in action, we can modify a Meteor Method to return a different result when run on the client versus the server. This is not typical, but it is useful to demonstrate optimistic UI.</p><p>Here is a simplified example from the upcoming Todo app. It inserts a document in the &quot;tasks&quot; collection. When run on the client updates Minimongo using the text passed as an argument. When run on the server uses a timeout to wait three seconds and then uses the uppercase version of the text. The Method first runs on the client and the UI renders a new task with the entered text. The Method then runs on the server. After the timeout it sends a message to the client that tells it to update Minimongo using the uppercase version of the text. The UI then updates to show the uppercase text.</p><pre class="language-js"><code class="language-js">Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Meteor requires using this version of setTimeout.</span><br>        <span class="token comment">// See https://docs.meteor.com/api/timers.html.</span><br>        Meteor<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>          <span class="token comment">// Tasks is a collection.</span><br>          <span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token operator">:</span> text<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token function">resolve</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">resolve</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>It is possible to define a Method only on the server-side, thereby opting out of optimistic UI. The UI will not update until the Method finishes executing on the server and sends back a result message. This is because Minimongo will not be updated until the result message is received.</p><p>Here is an example of defining a Method on the server taken from the upcoming Todo app. It deletes a task with a given id.</p><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3 id="tracker">Tracker</h3><p>Tracker is a dependency tracking system used by Meteor to update UIs when session variables and data sources change. From the Meteor <a href="https://docs.meteor.com/api/tracker.html" rel="noopener" target="_blank">Tracker docs</a>, &quot;When you call a function that supports reactive updates (such as a database query), it automatically saves the current <code>Computation</code> object, if any (representing, for example, the current template being rendered). Later, when the data changes, the function can &quot;invalidate&quot; the <code>Computation</code>, causing it to rerun (re-rendering the template).&quot;</p><p>There is a low-level API for using Tracker, but there are easier ways to use it in React and Svelte.</p><p>For React there is hook called <code>useTracker</code> for responding to tracker changes.</p><p>For Svelte, the <a href="https://atmospherejs.com/rdb/svelte-meteor-data" rel="noopener" target="_blank">rdb/svelte-meteor-data</a> provides a <code>useTracker</code> function.</p><p>For example, to always get the current user in a Svelte component:</p><pre class="language-js"><code class="language-js">$<span class="token operator">:</span> user <span class="token operator">=</span> <span class="token function">useTracker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Meteor<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The rdb/svelte-meteor-data package also turns MongoDB cursor objects into Svelte stores that automatically update whenever the database is updated in a way that affects the query results.</p><p>For example, to always get the latest tasks from a <code>Task</code> collection:</p><pre class="language-js"><code class="language-js">$<span class="token operator">:</span> tasks <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Note that both <code>user</code> and <code>tasks</code> are Svelte stores, so references to them should have a <code>$</code> prefix.</p><p>For more information on rdb/svelte-meteor-data, see this <a href="https://github.com/rdb/svelte-meteor-data/issues/6" rel="noopener" target="_blank">issue</a>.</p><h3 id="meteor-packages">Meteor Packages</h3><p>Meteor can use packages from npm and from its own package repository called &quot;Atmosphere&quot;. Atmosphere contains packages that are specific to Meteor.</p><p>To see the available packages in Atmosphere, browse <a href="https://atmospherejs.com/" rel="noopener" target="_blank">atmosphere.com</a>.</p><p>This page lists trending, recent, and most used packages.</p><p>To install a package from Atmosphere in your current Meteor project, enter <code>meteor add {package-name}</code>. This writes information about the installed packages to <code>.meteor/packages</code> to track dependencies similar to how npm uses the <code>package-lock.json</code> file.</p><p>Popular Atmosphere packages include:</p><ul><li>accounts-password - &quot;login service that enables secure password-based login&quot;</li><li>accounts-ui - &quot;turn-key user interface for Meteor Accounts&quot; using Blaze</li><li>meteor-base - &quot;default set of packages that almost every app will have&quot;</li><li>mongo - &quot;adaptor for using MongoDB and Minimongo over DDP&quot;</li><li>rdb:svelte-meteor-data - &quot;reactively track Meteor data inside Svelte components&quot;</li><li>react-meteor-data - &quot;React hook for reactively tracking Meteor data&quot;</li><li>static-html - &quot;define static page content in .html files&quot;; alternative to Blaze</li><li>svelte:compiler - compiles <code>.svelte</code> files to JavaScript</li><li>svelte:blaze-integration - &quot;render Blaze templates inside your Svelte components and vice versa&quot;; useful when using the account-ui package in a Svelte app</li><li>tracker - &quot;dependency tracker to allow reactive callbacks&quot;</li><li>typescript - &quot;compiler plugin that compiles TypeScript and ECMAScript in .ts and .tsx files&quot;</li></ul><h3 id="eslint">ESLint</h3><p>The steps to install and configure the ESLint linting tool for use in a Meteor project are listed below. They assume using Svelte as the web framework. When this is not the case, the Svelte-specific parts can be omitted.</p><ul><li><p>Enter <code>npm install eslint eslint-plugin-import eslint-plugin-svelte3</code></p></li><li><p>Add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint --fix --quiet '{client,imports,server}/**/*.{js,svelte}'"</span><span class="token punctuation">,</span></code></pre></li><li><p>Create the file <code>.eslintrc.json</code> containing the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"browser"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"es6"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"jest"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"node"</span><span class="token operator">:</span> <span class="token boolean">true</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"eslint:recommended"</span><span class="token punctuation">,</span> <span class="token string">"plugin:import/recommended"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"**/*.svelte"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token property">"processor"</span><span class="token operator">:</span> <span class="token string">"svelte3/svelte3"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"parserOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"ecmaVersion"</span><span class="token operator">:</span> <span class="token number">2019</span><span class="token punctuation">,</span><br>    <span class="token property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"import"</span><span class="token punctuation">,</span> <span class="token string">"svelte3"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li></ul><p>ESLint will give &quot;Unable to resolve path to module&quot; errors on all imports that begin with &quot;meteor/&quot;. However, the Meteor build system is able to resolve these. To suppress these errors, add the following to your <code>.eslintrc.json</code> file:</p><pre class="language-json"><code class="language-json"><span class="token property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token property">"import/no-unresolved"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token property">"ignore"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"^meteor/"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><h3 id="prettier">Prettier</h3><p>The steps to install and configure the Prettier code formatting tool for use in a Meteor project are listed below. They assume using Svelte as the web framework. When this is not the case, the Svelte-specific parts can be omitted.</p><ul><li><p>Enter <code>npm install prettier prettier-plugin-svelte</code></p></li><li><p>Add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"prettier --write '{client,imports,server}/**/*.{css,html,js,svelte}'"</span><span class="token punctuation">,</span></code></pre></li><li><p>Create the file <code>.prettierrc</code> containing personal preferences like the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"arrowParens"</span><span class="token operator">:</span> <span class="token string">"avoid"</span><span class="token punctuation">,</span><br>  <span class="token property">"bracketSpacing"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>  <span class="token property">"singleQuote"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"svelteSortOrder"</span><span class="token operator">:</span> <span class="token string">"scripts-markup-styles"</span><span class="token punctuation">,</span><br>  <span class="token property">"trailingComma"</span><span class="token operator">:</span> <span class="token string">"none"</span><br><span class="token punctuation">}</span></code></pre></li></ul><h3 id="tutorials">Tutorials</h3><p>The Meteor web site contains several tutorials <a href="https://www.meteor.com/tutorials" rel="noopener" target="_blank">here</a> that provide introductions to using Meteor.</p><h3 id="todo-app">Todo App</h3><p>Let's walk through the steps to build a Todo app using Meteor. This is a modified version of the Todo app presented at the Meteor site that demonstrates additional features. Code for the final version of this app can be found in <a href="https://github.com/mvolkmann/meteor-svelte-todos" rel="noopener" target="_blank">GitHub</a>.</p><ol><li><p>Create the app starting point by entering <code>meteor create todos</code>.</p><p>We are using the default app template here. To use a non-default app template, add one of the following options after <code>create</code>: <code>--bare</code>, <code>--minimal</code>, <code>--full</code>, <code>--react</code>, or <code>--typescript</code>. Interestingly none of these options corresponds to the default. The default option produces applications that are insecure and are therefore only for prototyping. Such applications allow all MongoDB updates to be initiated from clients. For details on the Meteor packages included by default and with each option see <a href="https://docs.meteor.com/commandline.html#meteorcreate" rel="noopener" target="_blank">here</a>.</p></li><li><p>Start the server by entering <code>cd todos</code> and <code>meteor</code>.</p></li><li><p>Browse localhost:3000 to see the following page:</p><p><img src="/blog/assets/meteor-default-page.png" alt="default Meteor app"></p></li><li><p>Press the &quot;Click Me&quot; button multiple times.</p><p>The text &quot;You've pressed the button n times.&quot; will update to display the number of times it was clicked.</p></li><li><p>Exercise &quot;hot code push&quot;.</p><p>The UI is defined by the following files in the <code>client</code> directory: <code>main.html</code>, <code>main.css</code>, and <code>main.js</code>. Try editing the file <code>client/main.html</code>. The browser will updated automatically when the changes are saved.</p></li><li><p>Configure the app to use the Svelte web framework, instead of the default Blaze framework.</p><p>Svelte is a good choice due to its use of reactive statements. For more information about Svelte, see <a href="https://objectcomputing.com/resources/publications/sett/july-2019-web-dev-simplified-with-svelte" rel="noopener" target="_blank">my article</a>.</p></li><li><p>Install Svelte by entering <code>meteor npm install svelte</code></p><p>It is recommended to use the command <code>meteor npm</code> instead of <code>npm</code> when installing npm packages in a Meteor app. When packages have binary dependencies, this ensures that they are built using the same C libraries.</p></li><li><p>Add some Meteor packages by entering<br><code>meteor add svelte:compiler rdb:svelte-meteor-data</code></p></li><li><p>Remove a package that will no longer be used by entering<br><code>meteor remove blaze-html-templates</code></p></li><li><p>Add a replacement Meteor package by entering<br><code>meteor add static-html</code></p></li><li><p>Replace the content of <code>client/main.html</code> with the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre></li><li><p>Replace the content of <code>client/main.js</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.svelte'</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>target<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create the file <code>client/Task.svelte</code> containing the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> task<span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">formatDate</span> <span class="token operator">=</span> <span class="token parameter">date</span> <span class="token operator">=></span><br>    date<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'en-us'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      month<span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span><br>      day<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br>      year<span class="token operator">:</span> <span class="token string">'numeric'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// These are Svelte "reactive declarations".</span><br>  $<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>createdAt<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token operator">=</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  $<span class="token operator">:</span> item <span class="token operator">=</span> text <span class="token operator">+</span> <span class="token punctuation">(</span>createdAt <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> - added </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">formatDate</span><span class="token punctuation">(</span>createdAt<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>{item}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">li</span> <span class="token punctuation">{</span><br>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre></li><li><p>Create the file <code>client/App.svelte</code> containing the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> Task <span class="token keyword">from</span> <span class="token string">'./Task.svelte'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">getTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> createdAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'This is task 1'</span><span class="token punctuation">,</span> createdAt<span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'This is task 2'</span><span class="token punctuation">,</span> createdAt<span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'This is task 3'</span><span class="token punctuation">,</span> createdAt<span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>      {#each getTasks() as task}<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>      {/each}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>At this point the app should display the following basic task list:</p><p><img src="/blog/assets/meteor-todo-1.png" alt="Todo App after step 14"></p></li><li><p>Replace the contents of <code>client/main.css</code> with what is found at <a href="https://github.com/meteor/simple-todos-svelte/blob/master/client/main.css" rel="noopener" target="_blank">here</a>. Now the task list is styled nicely.</p><p><img src="/blog/assets/meteor-todo-2.png" alt="Todo App after step 15"></p></li><li><p>Create a top-level project directory named <code>imports</code>.</p></li><li><p>Create the file <code>imports/tasks.js</code> containing the following which will create a MongoDB collection named &quot;tasks&quot;:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Mongo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/mongo'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following import near the top of <code>server/main.js</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following imports near the top of <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the <code>getTasks</code> function in <code>client/App.svelte</code> with the following in order to get tasks from MongoDB:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span>sort<span class="token operator">:</span> <span class="token punctuation">{</span>createdAt<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// newest first</span><br><span class="token comment">// This is a MongoDB cursor which is also a Svelte store.</span><br>$<span class="token operator">:</span> tasks <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the call to <code>getTasks()</code> in <code>client/App.svelte</code> with <code>$tasks</code>.</p><p>This is a reference to a Svelte store that is kept in sync with the MongoDB &quot;tasks&quot; collection. The UI will no longer display any tasks because this collection does not currently contain any tasks.</p></li><li><p>Insert some tasks using the MongoDB console by entering the following:</p><pre class="language-bash"><code class="language-bash">meteor mongo<br>db.tasks.insert<span class="token punctuation">(</span><span class="token punctuation">{</span> text: <span class="token string">"buy milk"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>db.tasks.insert<span class="token punctuation">(</span><span class="token punctuation">{</span> text: <span class="token string">"take out trash"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Note that the UI updates automatically to show these new tasks.</p><p><img src="/blog/assets/meteor-todo-3.png" alt="Todo App after step 22"></p></li><li><p>Enable adding tasks in the UI.</p><ul><li><p>Add the following inside the <code>script</code> element in <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token punctuation">,</span> createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following in <code>client/App.svelte</code> as the first child of the <code>section</code> element to prepare for adding tasks in the UI:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">on:</span>submit|preventDefault</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{addTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todo text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{text}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></li><li><p>Add the following after the HTML in <code>client/App.svelte</code>:</p><pre class="language-css"><code class="language-css"><span class="token selector">&lt;style><br>  form</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">section</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>&lt;/style></code></pre></li></ul><p>Now new tasks can be added by entering text in the input and either pressing the &quot;Add&quot; button or pressing the return key.</p><p><img src="/blog/assets/meteor-todo-4.png" alt="Todo App after step 25"></p></li><li><p>Note how Meteor keeps all clients in sync.</p><p>To see this, open a second web browser or another window in the same web browser and browse localhost:3000. Add a task in either browser window and notice that it appears in both.</p></li><li><p>Add the ability to mark tasks as done and delete them by changing <code>client/Task.svelte</code> to match the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> task<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">formatDate</span> <span class="token operator">=</span> <span class="token parameter">date</span> <span class="token operator">=></span><br>    date<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'en-us'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      month<span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span><br>      day<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br>      year<span class="token operator">:</span> <span class="token string">'numeric'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">toggleDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>done<span class="token operator">:</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>done<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  $<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>createdAt<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token operator">=</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  $<span class="token operator">:</span> item <span class="token operator">=</span> text <span class="token operator">+</span> <span class="token punctuation">(</span>createdAt <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> - added </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">formatDate</span><span class="token punctuation">(</span>createdAt<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{task.done}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{toggleDone}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">class:</span>done</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{task.done}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{item}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- Using Unicode trash can --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{deleteTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token entity" title="&#x1f5d1;">&amp;#x1f5d1;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">button</span> <span class="token punctuation">{</span><br>    <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span><br>    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">.done</span> <span class="token punctuation">{</span><br>    <span class="token property">opacity</span><span class="token punctuation">:</span> 0.3<span class="token punctuation">;</span><br>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> line-through<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">li</span> <span class="token punctuation">{</span><br>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>Now tasks can be marked as done by clicking the checkbox in front of them and they can be deleted by clicking the trash can icon after them.</p><p><img src="/blog/assets/meteor-todo-5.png" alt="Todo App after step 26"></p></li><li><p>Show the number of remaining tasks and total tasks in the heading by making the following changes in <code>client/App.svelte</code>:</p><ul><li><p>Add the following in the <code>script</code> element:</p><pre class="language-js"><code class="language-js">$<span class="token operator">:</span> remaining <span class="token operator">=</span> $tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token operator">!</span>t<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></code></pre></li><li><p>Add the following as the new first child of the <code>section</code> element:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stats<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{remaining} of {$tasks.length} remaining<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></li><li><p>Add the following inside the <code>style</code> element:</p><pre class="language-css"><code class="language-css"><span class="token selector">.stats</span> <span class="token punctuation">{</span><br>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li></ul><p>Now when tasks are added, toggled between done and not done, and deleted, the number of remaining tasks and total tasks is updated.</p><p><img src="/blog/assets/meteor-todo-6.png" alt="Todo App after step 27"></p></li><li><p>Add the ability to only display tasks that are not done by making the following changes in <code>client/App.svelte</code>:</p><ul><li><p>Add the following variable declaration in the <code>script</code> element:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> hideCompleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following inside the <code>form</code> element after the &quot;Add&quot; button:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hide-completed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{hideCompleted}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  Hide Completed Tasks<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></code></pre></li><li><p>Change the content of the <code>{#each}</code> block to the following:</p><pre class="language-html"><code class="language-html">{#if !hideCompleted || !task.done}<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>{/if}</code></pre></li></ul><p>Now when the &quot;Hide Completed Tasks&quot; checkbox is checked, only tasks that are not done are displayed.</p><p><img src="/blog/assets/meteor-todo-7.png" alt="Todo App after step 28"></p></li><li><p>Add support for user accounts by doing the following:</p><ul><li><p>Add some Meteor packages by entering<br><code>meteor add accounts-ui accounts-password svelte:blaze-integration</code></p></li><li><p>Create the file <code>client/accounts-config.js</code> with the following content:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Accounts<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/accounts-base'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Email is needed for the next step.</span><br>Accounts<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  passwordSignupFields<span class="token operator">:</span> <span class="token string">'USERNAME_AND_EMAIL'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following near the top of <code>client/main.js</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./accounts-config.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Modify the <code>client/App.svelte</code> file to match the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>useTracker<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/rdb:svelte-meteor-data'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>BlazeTemplate<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/svelte:blaze-integration'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> Task <span class="token keyword">from</span> <span class="token string">'./Task.svelte'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> hideCompleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> user<span class="token punctuation">;</span><br><br>  <span class="token comment">// user is a store</span><br>  $<span class="token operator">:</span> user <span class="token operator">=</span> <span class="token function">useTracker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Meteor<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span>sort<span class="token operator">:</span> <span class="token punctuation">{</span>createdAt<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// newest first</span><br>  <span class="token comment">// This is a MongoDB cursor which is also a Svelte store.</span><br>  $<span class="token operator">:</span> tasks <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  $<span class="token operator">:</span> remaining <span class="token operator">=</span> $tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token operator">!</span>t<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      text<span class="token punctuation">,</span><br>      createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      owner<span class="token operator">:</span> Meteor<span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      username<span class="token operator">:</span> $user<span class="token punctuation">.</span>username<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BlazeTemplate</span> <span class="token attr-name">template</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginButtons<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span><br>    {#if $user}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stats<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{remaining} of {$tasks.length} remaining<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">on:</span>submit|preventDefault</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{addTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todo text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{text}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hide-completed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{hideCompleted}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>        Hide Completed Tasks<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>      {#each $tasks as task} {#if !hideCompleted || !task.done}<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>      {/if} {/each}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>    {:else}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Please sign in.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    {/if}<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">form</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">section</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">.stats</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-buttons)</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span><br>    <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-buttons a)</span> <span class="token punctuation">{</span><br>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-dropdown-list)</span> <span class="token punctuation">{</span><br>    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span><br>    <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre></li></ul><p>Now users must create an account and sign in before they can view, add, and modify tasks.</p><p>Before a user signs in, they see a &quot;Sign in&quot; link in the upper-right.</p><p><img src="/blog/assets/meteor-todo-before-sign-in.png" alt="Todo App before sign in"></p><p>Clicking &quot;Sign in&quot; displays a dialog that contains a link to create an account.</p><p><img src="/blog/assets/meteor-todo-sign-in.png" alt="Todo App before sign in"></p><p>Clicking &quot;Create account&quot; changes the dialog to prompt for account information. By default, passwords must contain at least six characters, but there are no restrictions on the characters. There is not currently an easy way to customize password validation in order to enforce different rules. For possible solutions, see <a href="https://stackoverflow.com/questions/32651151/personalize-password-validation-function-used-by-accounts-ui" rel="noopener" target="_blank">here</a>.</p><p><img src="/blog/assets/meteor-todo-create-account.png" alt="Todo App before sign in"></p><p>After creating an account, or entering username and password for an existing account, the user is signed in and the &quot;Sign in&quot; link in the upper-right is replaced by their username.</p><p><img src="/blog/assets/meteor-todo-after-sign-in.png" alt="Todo App before sign in"></p><p>Clicking the username link in the upper-right presents a dialog for signing out or changing the password.</p><p><img src="/blog/assets/meteor-todo-click-username.png" alt="Todo App before sign in"></p><p>Clicking &quot;Change password&quot; changes the dialog to prompt for the current and new passwords.</p><p><img src="/blog/assets/meteor-todo-change-password.png" alt="Todo App before sign in"></p><p>After successfully changing the password, the dialog changes to notify the user.</p><p><img src="/blog/assets/meteor-todo-password-changed.png" alt="Todo App before sign in"></p></li><li><p>Add support for &quot;forgot password&quot; emails.</p><p>This will allow users to click the &quot;Forgot password&quot; link in the &quot;Sign in&quot; dialog which changes the dialog content to prompt for an email address. If a user account exists for the email address, an email is sent containing a link that the user can click to reset their password. After doing so they are immediately signed in.</p><ul><li><p>Add another Meteor packages by entering<br><code>meteor add email</code>.</p></li><li><p>Create the file <code>secrets.json</code> in the project root directory with content like the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"MAIL_NAME"</span><span class="token operator">:</span> <span class="token string">"Your Name"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_USER"</span><span class="token operator">:</span> <span class="token string">"some-user"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_PASSWORD"</span><span class="token operator">:</span> <span class="token string">"some-password"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_USER_DOMAIN"</span><span class="token operator">:</span> <span class="token string">"some-company.com"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_SERVER_DOMAIN"</span><span class="token operator">:</span> <span class="token string">"smtp.gmail.com"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_SERVER_PORT"</span><span class="token operator">:</span> <span class="token number">587</span><br><span class="token punctuation">}</span></code></pre><p>Note that the last two values above are specific to using a Google G Suite account for sending email. The values will differ if you are using a different email service. Another service to consider is <a href="https://mailchimp.com/" rel="noopener" target="_blank">MailChimp</a>.</p></li><li><p>If you are saving the project in a Git repository, add <code>secrets.json</code> to the <code>.gitignore</code> file so it is not added to the repository for others to see.</p></li><li><p>Create the file <code>server/accounts-setup.js</code> with the following content:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Accounts<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/accounts-base'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> secrets <span class="token keyword">from</span> <span class="token string">'../secrets.json'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> siteName <span class="token operator">=</span> <span class="token string">'Todos by Mark'</span><span class="token punctuation">;</span><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>siteName <span class="token operator">=</span> siteName<span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token keyword">from</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER_DOMAIN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>from <span class="token operator">=</span> <span class="token keyword">from</span><span class="token punctuation">;</span></code></pre></li><li><p>Modify the file <code>server/main.js</code> to match the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'./accounts-setup.js'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> secrets <span class="token keyword">from</span> <span class="token string">'../secrets.json'</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// code to run on server at startup</span><br>  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MAIL_URL</span> <span class="token operator">=</span><br>    <span class="token string">'smtp://'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER</span> <span class="token operator">+</span><br>    <span class="token string">'%40'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER_DOMAIN</span> <span class="token operator">+</span><br>    <span class="token string">':'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_PASSWORD</span> <span class="token operator">+</span><br>    <span class="token string">'@'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_SERVER_DOMAIN</span> <span class="token operator">+</span><br>    <span class="token string">':'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_SERVER_PORT</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><p>Now when I use clicks the &quot;Forgot password&quot; link in the sign in dialog, they can enter their email address and press the &quot;Reset password&quot; button.</p><p><img src="/blog/assets/meteor-todo-forgot-password.png" alt="Todo App forgot password"></p><p>When the email is sent, the dialog changes to include the text &quot;Email sent&quot;.</p><p><img src="/blog/assets/meteor-todo-forgot-password-email-sent.png" alt="Todo App forgot password email sent"></p><p>The user will receive an email like the following:</p><p><img src="/blog/assets/meteor-todo-password-reset-email.png" alt="Todo App password reset email"></p><p>Clicking the link opens the app in a new browser tab and displays a dialog for resetting the password.</p><p><img src="/blog/assets/meteor-todo-password-reset.png" alt="Todo App password reset"></p><p>After entering a new password, the user is notified that it has been reset and that they are now logged in.</p><p><img src="/blog/assets/meteor-todo-after-password-reset.png" alt="Todo App after password reset"></p></li><li><p>Make the app more secure by moving database interactions to the server.</p><p>This is accomplished by implementing Meteor Methods that are invoked by client-side code with calls to <code>Meteor.call(name, data, callback)</code>.</p><ul><li><p>Remove the Meteor package that allows client code to interact with MongoDB by entering <code>meteor remove insecure</code></p></li><li><p>Define Methods by modifying <code>imports/tasks.js</code> to match the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>check<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/check'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Mongo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/mongo'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br><br>    <span class="token comment">// Make sure the user is logged in before inserting a task.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Meteor<span class="token punctuation">.</span>Error</span><span class="token punctuation">(</span><span class="token string">'add-task'</span><span class="token punctuation">,</span> <span class="token string">'not-authorized'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> <span class="token punctuation">{</span>username<span class="token punctuation">}</span> <span class="token operator">=</span> Meteor<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      text<span class="token punctuation">,</span><br>      createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      owner<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">,</span><br>      username<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> id<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token function">setDone</span><span class="token punctuation">(</span><span class="token parameter">taskId<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// argument type validation</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> <span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>done<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create the file <code>client/util.js</code> containing the following error handling:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Replace this will better error handling later.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following <code>import</code> in <code>client/App.svelte</code> and <code>client/Task.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>handleError<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./util.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Change the call to <code>Tasks.insert</code> in the <code>addTask</code> function of <code>client/App.svelte</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'addTask'</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Remove the import of <code>Tasks</code> from <code>client/Task.svelte</code> since it is no longer used and add the following import:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span></code></pre></li><li><p>Change the call to <code>Tasks.remove</code> in the <code>deleteTask</code> function of <code>client/Task.svelte</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'deleteTask'</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Change the call to <code>Tasks.update</code> in the <code>toggleDone</code> function of <code>client/Task.svelte</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'setDone'</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>done<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><p>Nothing will change in the UI. But client-side code can no longer directly modify the MongoDB database.</p></li><li><p>Explicitly specify what data the server sends to the client so we can separate tasks by user.</p><p>Tasks will still be stored in the same MongoDB collection, but each user will only see and operate on the tasks they created.</p><ul><li><p>Remove the ability for the server to send any MongoDB content requested by clients.</p><p>Enter <code>meteor remove autopublish</code></p></li><li><p>Publish only tasks that belong to the logged in user by adding the following in <code>imports/tasks.js</code> after the line that starts with <code>export const Tasks</code></p><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// This is only run on the server.</span><br>  <span class="token comment">// An arrow function cannot be used here</span><br>  <span class="token comment">// because we need to use the "this" keyword.</span><br>  Meteor<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>owner<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following <code>import</code> in <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>onMount<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following in the <code>script</code> element of <code>client/App.svelte</code> to subscribe to all tasks that are published:</p><pre class="language-js"><code class="language-js"><span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Meteor<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><p>Now users only see and operate on their own tasks.</p></li><li><p>Require account email validation before users can view and operate on their tasks.</p><ul><li><p>Add the following at the bottom of <code>server/accounts-setup.js</code>:</p><pre class="language-js"><code class="language-js">Accounts<span class="token punctuation">.</span><span class="token function">onLogin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span>emails<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">.</span>verified<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Accounts<span class="token punctuation">.</span><span class="token function">sendVerificationEmail</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> email<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>verifyEmail <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token function">subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Activate your </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>siteName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> account.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">(</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hey </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, click the following link </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">to verify your email address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li><li><p>Determine if the logged in user has a verified email address by adding the following in <code>client/App.svelte</code> after the <code>$: user =</code> line:</p><pre class="language-js"><code class="language-js">$<span class="token operator">:</span> emailVerified <span class="token operator">=</span> $user <span class="token operator">&amp;&amp;</span> $user<span class="token punctuation">.</span>emails<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>verified<span class="token punctuation">;</span></code></pre></li><li><p>Change <code>{#if $user}</code> to <code>{#if $user &amp;&amp; emailVerified}</code></p></li><li><p>Add the following before the <code>{:else}</code> line:</p><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><span class="token operator">:</span><span class="token keyword">else</span> <span class="token keyword">if</span> $user <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>emailVerified<span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span>p<span class="token operator">></span><br>    You have been sent an email containing a link to verify your account<span class="token punctuation">.</span><br>    Please click that link <span class="token keyword">in</span> order to start adding tasks<span class="token punctuation">.</span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre></li></ul><p>Now after a user creates a new account, they will see the following:</p><p><img src="/blog/assets/meteor-todo-verify-email-sent.png" alt="Todo App verify email sent"></p><p>The user must must verify their email address by clicking a link in an email they receive like the following before they can start adding tasks.</p><p><img src="/blog/assets/meteor-todo-verify-email.png" alt="Todo App verify email"></p><p>Clicking the link in the email opens a browser tab containing the following:</p><p><img src="/blog/assets/meteor-todo-email-verified.png" alt="Todo App email verified"></p><p>The user can dismiss the dialog and proceed with using the app.</p><p>That's it! We now have a functioning Todo app that supports user accounts and tasks are persisted in a database. I can't imagine doing all of this in less code using anything other than Meteor!</p></li></ol><h3 id="building-and-deploying">Building and Deploying</h3><p>Now that we have our app running locally, we are ready to deploy it to a server for real users can access it.</p><p>To build a Meteor app for deployment, cd to the root project directory and enter <code>meteor build {dir-name}</code>. This creates the specified directory if it doesn't exist and creates a TAR file inside the directory named <code>{project-name}.tar.gz</code>. The TAR file contains a single directory named <code>bundle</code> which contains all the files for the client-side and server-side of the application. Include the <code>--architecture</code> option to build for a specific architecture. For help on the build command, enter <code>meteor help build</code>.</p><p>To deploy the app:</p><ol><li>Copy the TAR file to a server, perhaps using the <code>scp</code> command.</li><li>Start a terminal session on the server using the <code>ssh</code> command.</li><li>Verify that a recent version of Node.js is installed.</li><li>Un-tar the file by entering <code>tar zxf {project-name}.tar.gz</code></li><li>Enter <code>cd {project-name}/programs/server</code></li><li>Enter <code>npm install</code></li><li>Set the <code>MONGO_URL</code> environment variable to <code>mongodb://localhost:27017/myapp</code></li><li>Set the <code>ROOT_URL</code> environment variable to <code>http://myapp.com</code></li><li>Enter <code>node main.js</code> to start the server.</li></ol><p>TODO: What should the value of &quot;myapp&quot; be in the environment variables.</p><p>Other alternatives for deploying Meteor apps include Galaxy (<a href="https://www.meteor.com/hosting" rel="noopener" target="_blank">here</a>) and Meteor Up (<a href="http://meteor-up.com/" rel="noopener" target="_blank">here</a>). Meteor Up, a.k.a mup, can be used to deploy a Meteor app to any server to which you can <code>ssh</code>.</p><h4 id="galaxy">Galaxy</h4><p>Galaxy provides a free, one-month trial.</p><p>Galaxy does not provided MongoDB hosting. They recommend using <a href="https://www.mongodb.com/cloud/atlas" rel="noopener" target="_blank">MongoDB Atlas</a> for that, which has an endless free tier referred to as &quot;Shared Clusters&quot; that does not provide backup.</p><p>To use MongoDB Atlas:</p><ul><li>Browse <a href="https://www.mongodb.com/cloud/atlas" rel="noopener" target="_blank">MongoDB Atlas</a>.</li><li>Choose between AWS, GCP, and Azure for the cloud provider.</li><li>Create a cluster.</li><li>In the left nav. under &quot;SECURITY&quot;, click &quot;Database Access&quot; and press &quot;Add New Database User&quot;.</li><li>Optionally change the default username and password.</li><li>Select &quot;Database User Privileges&quot; from the drop-down. You will likely want &quot;Read and write to any database&quot;.</li><li>Press &quot;Add User&quot;.</li><li>In the left nav. under &quot;SECURITY&quot;, click &quot;Network Access&quot; and press &quot;ADD IP ADDRESS&quot;.</li><li>Enter IP addresses that should have access. You will likely want the IP address of your machine AND the IP address of the Galaxy server.</li><li>To connect from the mongo shell:<ul><li>In the left nav. under &quot;DATA STORAGE&quot;, click &quot;Clusters&quot;.</li><li>Press &quot;CONNECT&quot;.</li><li>Click &quot;Connect with the mongo shell&quot;.</li><li>If you do not already have the mongo shell installed, click &quot;I do not have the mongo shell installed&quot; and follow the platform-specific instructions to install it.</li><li>Otherwise, click &quot;I have the mongo shell installed&quot;.</li><li>Press &quot;Copy&quot; after the supplied connection string.</li><li>Open a terminal window.</li><li>Paste the connection string.</li><li>Replace &quot;<dbname>&quot; with the name of an existing database and press return.</dbname></li><li>Enter the password.</li><li>Enter &quot;show collections&quot; to list the collections within the database.</li></ul></li><li>To connect from the MongoDB Compass app:<ul><li>In the left nav. under &quot;DATA STORAGE&quot;, click &quot;Clusters&quot;.</li><li>Press &quot;CONNECT&quot;.</li><li>Click &quot;Connect using MongoDB Compass&quot;.</li><li>If you do not already have MongoDB Compass installed, click &quot;I do not have MongoDB Compass&quot; and follow the platform-specific instructions to install it.</li><li>Otherwise, click &quot;I have MongoDB Compass&quot;.</li><li>Press &quot;Copy&quot; after the supplied connection string.</li><li>Open the MongoDB Compass app.</li><li>Paste the connection string.</li><li>Replace &quot;<password>&quot; with the password and press &quot;CONNECT&quot;.</password></li><li>Click a database name to see the collections inside it.</li></ul></li></ul><p>To use Galaxy:</p><ul><li>Browse <a href="https://galaxy.meteor.com" rel="noopener" target="_blank">galaxy.meteor.com</a></li><li>Sign in</li><li>Create a free trial account</li><li>Choose a region (ex. &quot;US-East-1&quot;)</li></ul><h3 id="resources">Resources</h3><ul><li>(<a href="https://meteor.com/" rel="noopener" target="_blank">Meteor home page</a>)</li><li>(<a href="https://docs.meteor.com/" rel="noopener" target="_blank">Meteor API docs</a>)</li><li><a href="https://github.com/Urigo/awesome-meteor" rel="noopener" target="_blank">Awesome Meteor</a> curated list of packages and libraries</li><li><a href="https://atmospherejs.com/" rel="noopener" target="_blank">Atmosphere Meteor package repository</a></li><li><a href="https://forums.meteor.com/" rel="noopener" target="_blank">Meteor Forum</a></li><li><a href="https://stackoverflow.com/questions/tagged/meteor" rel="noopener" target="_blank">Stack Overflow</a></li></ul></article>